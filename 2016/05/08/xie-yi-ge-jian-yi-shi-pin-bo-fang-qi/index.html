<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 写一个简易视频播放器 · 一鸣的博客</title><meta name="description" content="写一个简易视频播放器 - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">写一个简易视频播放器</h1><div class="post-info">2016年5月8日</div><div class="post-content"><p>周末抽时间写了个视频播放器，学习使用 Sketch，画了几个图标。实现功能如下：</p>
<ul>
<li>手势调节视频进度</li>
<li>手势调节视频亮度</li>
<li>手势调节音量</li>
</ul>
<p>实现效果图：</p>
<p><img src="/images/VideoPlayer/0.png" alt="/images/VideoPlayer"></p>
<a id="more"></a>
<p>废话少说，直接上代码：</p>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> player: <span class="type">AVPlayer</span> = &#123;</div><div class="line">   <span class="keyword">let</span> asset = <span class="type">AVURLAsset</span>(<span class="type">URL</span>: <span class="keyword">self</span>.<span class="type">URL</span>)</div><div class="line">   <span class="keyword">let</span> playerItem = <span class="type">AVPlayerItem</span>(asset: asset)</div><div class="line">   <span class="keyword">var</span> player = <span class="type">AVPlayer</span>(playerItem: playerItem)</div><div class="line">        </div><div class="line">   <span class="keyword">let</span> vol = <span class="type">AVAudioSession</span>.sharedInstance().outputVolume</div><div class="line">   player.volume = <span class="number">20.0</span> * log10f(vol + <span class="type">FLT_MIN</span>)</div><div class="line">   <span class="keyword">self</span>.startVolume =  player.volume;</div><div class="line">        </div><div class="line">   <span class="keyword">return</span> player</div><div class="line">&#125;()</div><div class="line"></div><div class="line"><span class="keyword">let</span> playerLayer = <span class="type">AVPlayerLayer</span>(player: player)</div><div class="line">playerLayer.frame = <span class="keyword">self</span>.bounds</div><div class="line"><span class="keyword">self</span>.layer.addSublayer(playerLayer)</div></pre></td></tr></table></figure>
<h2 id="添加监听属性"><a href="#添加监听属性" class="headerlink" title="添加监听属性"></a>添加监听属性</h2><p>监听的属性有：  </p>
<ul>
<li>播放进度</li>
<li>音量</li>
<li>亮度</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dynamic</span> <span class="keyword">private</span> <span class="keyword">var</span> brightness: <span class="type">Float</span> = <span class="number">1</span> <span class="comment">// 亮度</span></div><div class="line"><span class="keyword">dynamic</span> <span class="keyword">private</span> <span class="keyword">var</span> volume: <span class="type">Float</span> = <span class="number">1</span>  <span class="comment">// 音量</span></div><div class="line"><span class="keyword">dynamic</span> <span class="keyword">private</span> <span class="keyword">var</span> progress: <span class="type">Float</span> = <span class="number">1</span> <span class="comment">// 播放进度</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">addObserver</span><span class="params">()</span></span> &#123;  </div><div class="line">   <span class="comment">// 添加视频播放进度监听</span></div><div class="line">   player.addPeriodicTimeObserverForInterval(<span class="type">CMTimeMakeWithSeconds</span>(<span class="number">1.0</span>,<span class="type">Int32</span>(<span class="type">NSEC_PER_SEC</span>)), queue: <span class="literal">nil</span>, usingBlock: &#123; (time) <span class="keyword">in</span></div><div class="line">        <span class="keyword">let</span> doneTime = <span class="type">CMTimeGetSeconds</span>(time)</div><div class="line">        <span class="keyword">let</span> undoneTime = <span class="keyword">self</span>.totalDuration - doneTime</div><div class="line">            </div><div class="line">        <span class="keyword">self</span>.configView.progressView.beginTime = doneTime</div><div class="line">        <span class="keyword">self</span>.configView.progressView.endTime = undoneTime</div><div class="line">        <span class="keyword">self</span>.configView.progressView.progress = doneTime/<span class="keyword">self</span>.totalDuration</div><div class="line">    &#125;)</div><div class="line">        </div><div class="line">    <span class="comment">// 亮度</span></div><div class="line">    <span class="keyword">self</span>.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"brightness"</span>, options: .<span class="type">New</span>, context: <span class="literal">nil</span>)</div><div class="line">    <span class="comment">// 音量</span></div><div class="line">    <span class="keyword">self</span>.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"volume"</span>, options: .<span class="type">New</span>, context: <span class="literal">nil</span>)</div><div class="line">    <span class="comment">// 播放进度</span></div><div class="line">    <span class="keyword">self</span>.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"progress"</span>, options: .<span class="type">New</span>, context: <span class="literal">nil</span>)</div><div class="line">&#125;</div><div class="line">    </div><div class="line"><span class="comment">// 移除监听</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeObserver</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">self</span>.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"brightness"</span>)</div><div class="line">    <span class="keyword">self</span>.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"volume"</span>)</div><div class="line">    <span class="keyword">self</span>.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"progress"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">observeValueForKeyPath</span><span class="params">(keyPath: String?, ofObject object: AnyObject?, change: [String : AnyObject]?, context: UnsafeMutablePointer&lt;Void&gt;)</span></span> &#123;</div><div class="line">    <span class="keyword">if</span> keyPath == <span class="string">"brightness"</span> &#123; <span class="comment">// 亮度</span></div><div class="line">        <span class="keyword">let</span> brightnessValue = change![<span class="string">"new"</span>] <span class="keyword">as</span>! <span class="type">CGFloat</span></div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.configView.lightView.progress = brightnessValue</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> keyPath == <span class="string">"volume"</span> &#123; <span class="comment">// 音量</span></div><div class="line">        <span class="keyword">let</span> volumeValue = change![<span class="string">"new"</span>] <span class="keyword">as</span>! <span class="type">Float</span></div><div class="line">        player.volume = volumeValue</div><div class="line">        configView.volumeView.progress = <span class="type">CGFloat</span>(volumeValue)</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> keyPath == <span class="string">"progress"</span> &#123; <span class="comment">// 播放进度</span></div><div class="line">        <span class="keyword">let</span> progressValue = change![<span class="string">"new"</span>] <span class="keyword">as</span>! <span class="type">Float</span></div><div class="line">        <span class="keyword">let</span> dragedSeconds = floorf(<span class="type">Float</span>(totalDuration) * progressValue);</div><div class="line">        <span class="keyword">let</span> newCMTime = <span class="type">CMTimeMake</span>(<span class="type">Int64</span>(dragedSeconds),<span class="number">1</span>);</div><div class="line">        player.seekToTime(newCMTime)</div><div class="line">        player.play()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="手势实现调节播放进度、亮度、音量"><a href="#手势实现调节播放进度、亮度、音量" class="headerlink" title="手势实现调节播放进度、亮度、音量"></a>手势实现调节播放进度、亮度、音量</h2><p>建一个配置类型枚举：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">VideoPlayerConfigType</span> </span>&#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">None</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Volume</span> <span class="comment">// 调节音量</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Brightness</span> <span class="comment">// 调节亮度</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Progress</span> <span class="comment">// 调节进度</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置 <code>touchesBegan</code> 方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</div><div class="line">    <span class="keyword">guard</span> event?.allTouches()?.<span class="built_in">count</span> == <span class="number">1</span> <span class="keyword">else</span> &#123; <span class="comment">// 一个手指</span></div><div class="line">        <span class="keyword">return</span></div><div class="line">    &#125;    </div><div class="line">    </div><div class="line">    <span class="keyword">let</span> touch = touches.first </div><div class="line">    <span class="keyword">let</span> location = touch?.locationInView(<span class="keyword">self</span>)</div><div class="line">        </div><div class="line">    configType = .<span class="type">None</span> <span class="comment">// 配置类型</span></div><div class="line">    startLocation = location! <span class="comment">// 开始位置</span></div><div class="line">    </div><div class="line">    <span class="comment">// 起始进度</span></div><div class="line">    startProgress =  <span class="type">CMTimeGetSeconds</span>(player.currentItem!.currentTime()) / totalDuration</div><div class="line">    <span class="comment">// 起始亮度</span></div><div class="line">    startBrightness = <span class="type">Float</span>(<span class="type">UIScreen</span>.mainScreen().brightness)</div><div class="line">    <span class="comment">// 起始音量 （后续会改为系统音量设置）</span></div><div class="line">    startVolume = player.volume</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置 <code>touchesMoved</code> 方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</div><div class="line">    <span class="keyword">guard</span> event?.allTouches()?.<span class="built_in">count</span> == <span class="number">1</span> <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    <span class="keyword">let</span> touch = touches.first</div><div class="line">    <span class="keyword">let</span> location = touch?.locationInView(<span class="keyword">self</span>)</div><div class="line">        </div><div class="line">    <span class="keyword">let</span> changeY = location!.y - startLocation.y;</div><div class="line">    <span class="keyword">let</span> changeX = location!.x - startLocation.x;</div><div class="line">        </div><div class="line">    <span class="keyword">if</span> configType == .<span class="type">None</span> &#123;</div><div class="line">        <span class="keyword">if</span> fabs(changeX) &gt; fabs(changeY) &#123; <span class="comment">// 左右滑动</span></div><div class="line">            configType = .<span class="type">Progress</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> fabs(changeY) &gt; fabs(changeX) &#123; <span class="comment">// 上下滑动</span></div><div class="line">            <span class="keyword">let</span> screenWidth = <span class="type">CGRectGetHeight</span>(<span class="type">UIScreen</span>.mainScreen().bounds)</div><div class="line">            <span class="keyword">if</span> location!.x &gt;= screenWidth/<span class="number">2.0</span> &#123; <span class="comment">// 屏幕右侧滑动</span></div><div class="line">                configType = .<span class="type">Volume</span></div><div class="line">                startVolume = player.volume</div><div class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 屏幕左侧滑动</span></div><div class="line">                configType = .<span class="type">Brightness</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> configType == .<span class="type">Volume</span> &#123; <span class="comment">// 音量</span></div><div class="line">        <span class="keyword">let</span> yOffset = (<span class="type">Float</span>(startLocation.y - (location?.y)!))/<span class="number">100</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">if</span> (startVolume + yOffset) &gt; <span class="number">1</span> &#123; <span class="comment">// 音量 &gt; 1 设置为 1</span></div><div class="line">            startLocation = location!</div><div class="line">                </div><div class="line">            startVolume = <span class="number">1</span></div><div class="line">            volume = <span class="number">1</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (startVolume + yOffset) &lt; <span class="number">0</span> &#123; <span class="comment">// 音量 &lt; 0 设置为 0</span></div><div class="line">            startLocation = location!</div><div class="line">                </div><div class="line">            startVolume = <span class="number">0</span></div><div class="line">            volume = <span class="number">0</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 正常范围</span></div><div class="line">            volume = startVolume + yOffset</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(<span class="string">"音量: <span class="subst">\(volume)</span>"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> configType == .<span class="type">Brightness</span> &#123; <span class="comment">// 亮度</span></div><div class="line">        <span class="keyword">let</span> yOffset = (<span class="type">Float</span>(startLocation.y - (location?.y)!))/<span class="number">100</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">if</span> (startBrightness + yOffset) &gt; <span class="number">1</span> &#123; <span class="comment">// 亮度 &gt; 1 设置为 1</span></div><div class="line">            startLocation = location!</div><div class="line">                </div><div class="line">            brightness = <span class="number">1</span>;</div><div class="line">            startBrightness = <span class="number">1</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (startBrightness + yOffset) &lt; <span class="number">0</span> &#123; <span class="comment">// 亮度 &lt; 0 设置为 0</span></div><div class="line">            startLocation = location!</div><div class="line">                </div><div class="line">            brightness = <span class="number">0</span>;</div><div class="line">            startBrightness = <span class="number">0</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 正常范围</span></div><div class="line">            brightness = startBrightness + yOffset</div><div class="line">        &#125;</div><div class="line">            </div><div class="line">        <span class="built_in">print</span>(<span class="string">"亮度: <span class="subst">\(brightness)</span>"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> configType == .<span class="type">Progress</span> &#123; <span class="comment">// 进度</span></div><div class="line">        <span class="keyword">let</span> screenHeight = <span class="type">CGRectGetHeight</span>(<span class="type">UIScreen</span>.mainScreen().bounds)</div><div class="line">        <span class="keyword">let</span> xOffset = (<span class="type">Double</span>((location?.x)! - startLocation.x))/<span class="type">Double</span>(screenHeight);</div><div class="line">            </div><div class="line">        <span class="keyword">if</span> (startProgress + xOffset) &gt; <span class="number">1</span> &#123; <span class="comment">// 播放进度 &gt; 1 设置为 1</span></div><div class="line">            startLocation = location!</div><div class="line">                </div><div class="line">            startProgress = <span class="number">1</span></div><div class="line">            progress = <span class="number">1</span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (startProgress + xOffset) &lt; <span class="number">0</span> &#123; <span class="comment">// 播放进度 &lt; 0 设置为 0</span></div><div class="line">            startLocation = location!</div><div class="line">                </div><div class="line">            startProgress = <span class="number">0</span></div><div class="line">            progress = <span class="number">0</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 正常进度</span></div><div class="line">            progress = <span class="type">Float</span>(startProgress + xOffset)</div><div class="line">        &#125;</div><div class="line">            </div><div class="line">        <span class="built_in">print</span>(<span class="string">"进度 <span class="subst">\(startProgress + xOffset)</span>"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="亮度视图（音量视图、进度视图类似）"><a href="#亮度视图（音量视图、进度视图类似）" class="headerlink" title="亮度视图（音量视图、进度视图类似）"></a>亮度视图（音量视图、进度视图类似）</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LightView</span>: <span class="title">UIView</span> </span>&#123;</div><div class="line">    <span class="keyword">dynamic</span> <span class="keyword">var</span> progress: <span class="type">CGFloat</span> = <span class="number">0.0</span> <span class="comment">// 进度</span></div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.addObserver()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">deinit</span> &#123;</div><div class="line">        <span class="keyword">self</span>.removeObserver()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addObserver</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.addObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"progress"</span>, options: .<span class="type">New</span>, context: <span class="literal">nil</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">removeObserver</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.removeObserver(<span class="keyword">self</span>, forKeyPath: <span class="string">"progress"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 配置界面 使用 frame 实现</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">configUI</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> lightIncreaseImage = <span class="type">UIImage</span>.<span class="keyword">init</span>(named: <span class="string">"Light_Increase"</span>)!</div><div class="line">        <span class="keyword">let</span> lightIncreaseImageSize = lightIncreaseImage.size</div><div class="line">        <span class="keyword">let</span> lightIncreaseImageView = <span class="type">UIImageView</span>.<span class="keyword">init</span>(image: lightIncreaseImage)</div><div class="line">        lightIncreaseImageView.frame = <span class="type">CGRect</span>(x: (<span class="keyword">self</span>.frame.width - lightIncreaseImageSize.width)/<span class="number">2.0</span>, y: <span class="number">0</span>, width: lightIncreaseImageSize.width, height: lightIncreaseImageSize.height)</div><div class="line">        <span class="keyword">self</span>.addSubview(lightIncreaseImageView)</div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.layer.addSublayer(undoneLayer)</div><div class="line">        <span class="keyword">self</span>.layer.addSublayer(doneLayer)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> lightDecreaseImage = <span class="type">UIImage</span>.<span class="keyword">init</span>(named: <span class="string">"Light_Decrease"</span>)!</div><div class="line">        <span class="keyword">let</span> lightDecreaseImageSize = lightDecreaseImage.size</div><div class="line">        <span class="keyword">let</span> lightDecreaseImageView = <span class="type">UIImageView</span>.<span class="keyword">init</span>(image: lightDecreaseImage)</div><div class="line">        lightDecreaseImageView.frame = <span class="type">CGRect</span>(x: (<span class="keyword">self</span>.frame.width - lightDecreaseImageSize.width)/<span class="number">2.0</span>, y: <span class="keyword">self</span>.frame.height - lightDecreaseImageSize.height, width: lightDecreaseImageSize.width, height: lightDecreaseImageSize.height)</div><div class="line">        <span class="keyword">self</span>.addSubview(lightDecreaseImageView)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 未设置的亮度 Layer</span></div><div class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> undoneLayer: <span class="type">CALayer</span> = &#123;</div><div class="line">        <span class="keyword">var</span> undoneLayer = <span class="type">CALayer</span>()</div><div class="line">        undoneLayer.frame = <span class="type">CGRectMake</span>((<span class="keyword">self</span>.frame.width - <span class="number">4</span>)/<span class="number">2.0</span>, (<span class="keyword">self</span>.frame.height - <span class="number">140</span>)/<span class="number">2.0</span>, <span class="number">4</span>, <span class="number">140</span>)</div><div class="line">        undoneLayer.backgroundColor = <span class="type">UIColor</span>.<span class="keyword">init</span>(white: <span class="number">1</span>, alpha: <span class="number">0.2</span>).<span class="type">CGColor</span></div><div class="line">        <span class="keyword">return</span> undoneLayer</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">    <span class="comment">// 已经设置的亮度 Layer 比 未设置的亮度 Layer 白一点</span></div><div class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> doneLayer: <span class="type">CALayer</span> = &#123;</div><div class="line">        <span class="keyword">var</span> doneLayer = <span class="type">CALayer</span>()</div><div class="line">        doneLayer.frame = <span class="type">CGRectMake</span>((<span class="keyword">self</span>.frame.width - <span class="number">4</span>)/<span class="number">2.0</span>, (<span class="keyword">self</span>.frame.height - <span class="number">140</span>)/<span class="number">2.0</span> + <span class="number">100</span>, <span class="number">4</span>, <span class="number">40</span>)</div><div class="line">        doneLayer.backgroundColor = <span class="type">UIColor</span>.<span class="keyword">init</span>(white: <span class="number">1</span>, alpha: <span class="number">0.6</span>).<span class="type">CGColor</span></div><div class="line">        <span class="keyword">return</span> doneLayer</div><div class="line">    &#125;()</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">observeValueForKeyPath</span><span class="params">(keyPath: String?, ofObject object: AnyObject?, change: [String : AnyObject]?, context: UnsafeMutablePointer&lt;Void&gt;)</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> keyPath == <span class="string">"progress"</span> &#123;</div><div class="line">            <span class="keyword">let</span> doneValue = change![<span class="string">"new"</span>] <span class="keyword">as</span>! <span class="type">CGFloat</span></div><div class="line">            <span class="keyword">let</span> progress = doneValue * <span class="number">140</span></div><div class="line">            <span class="type">UIScreen</span>.mainScreen().brightness = doneValue <span class="comment">// 设置屏幕亮度</span></div><div class="line">            doneLayer.frame = <span class="type">CGRectMake</span>((<span class="keyword">self</span>.frame.width - <span class="number">4</span>)/<span class="number">2.0</span>, (<span class="keyword">self</span>.frame.height - <span class="number">140</span>)/<span class="number">2.0</span> + (<span class="number">140</span> - progress), <span class="number">4</span>, progress)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>功能还有待完善，后续会优化及添加一些其他功能：</p>
<ul>
<li>使用 Auto Layout 进行布局</li>
<li>双击暂停等更多手势添加</li>
<li>视频导入（ WiFi、iTunes ）</li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/2016/05/22/zi-ding-yi-xia-la-shua-xin/" class="prev">上一篇</a><a href="/2016/04/24/sdwebimage-3/" class="next">下一篇</a></div><div data-thread-key="2016/05/08/xie-yi-ge-jian-yi-shi-pin-bo-fang-qi/" data-title="写一个简易视频播放器" data-url="http://iYiming.me/2016/05/08/xie-yi-ge-jian-yi-shi-pin-bo-fang-qi/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?3cec0b24b46b86302d1aa3b050d4668f";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script></body></html>