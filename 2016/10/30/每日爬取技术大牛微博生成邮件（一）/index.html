<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 每日爬取技术大牛微博生成邮件（一） · 一鸣的博客</title><meta name="description" content="Python"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">每日爬取技术大牛微博生成邮件（一）</h1><div class="post-info">2016年10月30日</div><div class="post-content"><p><img src="/images/weibo_spider/1.jpg" alt="微博爬虫"></p>
<p>一年前，自己开通了公众号，将每天微博上最新的 iOS 技术文章，制作成笔记的形式分享出来。持续了一年时间，最近因为创业，已经好些天没有更新了。最近有人向我反馈这个问题，我也拿比较忙没有时间推脱。</p>
<p>随着问的人越来越多，开始思考，怎么用技术的手段自动化生成这些笔记,想到前段时间学习到的 Python，想利用爬虫来解决这个问题。</p>
<a id="more"></a>
<p>爬取步骤：  </p>
<ol>
<li>分析微博网站。找到获取某个用户微博数据的 URL。</li>
<li>通过 URL 获取到微博内容。ID、微博内容、转发内容、时间等。</li>
<li>清洗数据。数据爬取出来可能有杂质，比如带有 HTML 标签，需要清洗数据。</li>
<li>将数据存入数据库</li>
<li>每天 8:00 从数据库中取出昨天数据，并生成带有格式的邮件。 </li>
</ol>
<h1 id="分析微博网站"><a href="#分析微博网站" class="headerlink" title="分析微博网站"></a>分析微博网站</h1><p>我分析的移动版本的微博 <a href="http://m.weibo.cn" target="_blank" rel="external">http://m.weibo.cn</a>，反反复复，找到下面这个好用的链接。</p>
<p><a href="http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1" target="_blank" rel="external">http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1</a></p>
<h1 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h1><p>因为上面的链接返回的是 JSON 数据，不是 HTML 数据，这样大大减少了爬取的难度。数据格式如下（做了处理，仅列出一条微博的结构）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"mblog"</span>: &#123;</div><div class="line">        <span class="attr">"created_at"</span>: <span class="string">"1分钟前"</span>,</div><div class="line">        <span class="attr">"id"</span>: <span class="number">4036329354589998</span>,</div><div class="line">        <span class="attr">"mid"</span>: <span class="string">"4036329354589998"</span>,</div><div class="line">        <span class="attr">"idstr"</span>: <span class="string">"4036329354589998"</span>,</div><div class="line">        <span class="attr">"text"</span>: <span class="string">"转发微博"</span>,</div><div class="line">        <span class="attr">"source_allowclick"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"source_type"</span>: <span class="number">1</span>,</div><div class="line">        <span class="attr">"source"</span>: <span class="string">"iPhone 6 Plus"</span>,</div><div class="line">        <span class="attr">"appid"</span>: <span class="number">1370926</span>,</div><div class="line">        <span class="attr">"favorited"</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">"pic_ids"</span>: [],</div><div class="line">        <span class="attr">"user"</span>: &#123;</div><div class="line">            <span class="attr">"id"</span>: <span class="number">2088894917</span>,</div><div class="line">            <span class="attr">"screen_name"</span>: <span class="string">"iYiming"</span>,</div><div class="line">            <span class="attr">"profile_image_url"</span>: <span class="string">"http://tva2.sinaimg.cn/crop.0.0.908.908.180/7c8201c5jw8enyqfi4y8ej20p80p8gn8.jpg"</span>,</div><div class="line">            <span class="attr">"profile_url"</span>: <span class="string">"/u/2088894917"</span>,</div><div class="line">            <span class="attr">"statuses_count"</span>: <span class="number">4495</span>,</div><div class="line">            <span class="attr">"verified"</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">"verified_reason"</span>: <span class="string">""</span>,</div><div class="line">            <span class="attr">"description"</span>: <span class="string">"越努力 越幸运！"</span>,</div><div class="line">            <span class="attr">"remark"</span>: <span class="string">""</span>,</div><div class="line">            <span class="attr">"verified_type"</span>: <span class="number">-1</span>,</div><div class="line">            <span class="attr">"gender"</span>: <span class="string">"m"</span>,</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"retweeted_status"</span>: &#123;</div><div class="line">            <span class="attr">"created_at"</span>: <span class="string">"今天 02:34"</span>,</div><div class="line">            <span class="attr">"id"</span>: <span class="number">4036105911562416</span>,</div><div class="line">            <span class="attr">"mid"</span>: <span class="string">"4036105911562416"</span>,</div><div class="line">            <span class="attr">"idstr"</span>: <span class="string">"4036105911562416"</span>,</div><div class="line">            <span class="attr">"text"</span>: <span class="string">"我写了新文章《2016年末闲谈iOS开发的未来》（ 分享自 &lt;a href='/n/简书'&gt;@简书&lt;/a&gt; ） &lt;a data-url=\"http://t.cn/RVmxjs7\" href=\"http://media.weibo.cn/article?id=2309614036183188449410&amp;object_id=1022%3A2309614036183188449410&amp;url_type=39&amp;object_type=article&amp;pos=1&amp;containerid=&amp;\" &gt;&lt;i class=\"iconimg iconimg-xs\"&gt;&lt;img src=\"http://h5.sinaimg.cn/upload/2015/09/25/3/timeline_card_small_article_default.png\"&gt;&lt;/i&gt;&lt;span class=\"surl-text\"&gt;2016年末闲谈iO...&lt;/span&gt;&lt;/a&gt;"</span>,</div><div class="line">            <span class="attr">"textLength"</span>: <span class="number">79</span>,</div><div class="line">            <span class="attr">"source_allowclick"</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">"source_type"</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">"source"</span>: <span class="string">"简书"</span>,</div><div class="line">            <span class="attr">"appid"</span>: <span class="number">623636</span>,</div><div class="line">            <span class="attr">"favorited"</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">"pic_ids"</span>: [</div><div class="line">                <span class="string">"72d10fc2jw1f99ph0z9v7j20hs8tbb13"</span></div><div class="line">            ],</div><div class="line">            <span class="attr">"thumbnail_pic"</span>: <span class="string">"http://ww4.sinaimg.cn/thumbnail/72d10fc2jw1f99ph0z9v7j20hs8tbb13.jpg"</span>,</div><div class="line">            <span class="attr">"bmiddle_pic"</span>: <span class="string">"http://ww4.sinaimg.cn/bmiddle/72d10fc2jw1f99ph0z9v7j20hs8tbb13.jpg"</span>,</div><div class="line">            <span class="attr">"original_pic"</span>: <span class="string">"http://ww4.sinaimg.cn/large/72d10fc2jw1f99ph0z9v7j20hs8tbb13.jpg"</span>,</div><div class="line">            <span class="attr">"reposts_count"</span>: <span class="number">145</span>,</div><div class="line">            <span class="attr">"comments_count"</span>: <span class="number">24</span>,</div><div class="line">            <span class="attr">"attitudes_count"</span>: <span class="number">34</span>,</div><div class="line">            <span class="attr">"isLongText"</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">"mlevel"</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">"biz_feature"</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">"hasActionTypeCard"</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">"userType"</span>: <span class="number">0</span>,</div><div class="line">            <span class="attr">"cardid"</span>: <span class="string">"vip_002"</span>,</div><div class="line">            <span class="attr">"is_show_bulletin"</span>: <span class="number">2</span>,</div><div class="line">            <span class="attr">"created_timestamp"</span>: <span class="number">1477766099</span>,</div><div class="line">            <span class="attr">"bid"</span>: <span class="string">"Ef9hl6ysg"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"reposts_count"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"comments_count"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"attitudes_count"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"isLongText"</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">"mlevel"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"biz_feature"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"hasActionTypeCard"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"hot_weibo_tags"</span>: [],</div><div class="line">        <span class="attr">"text_tag_tips"</span>: [],</div><div class="line">        <span class="attr">"userType"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"positive_recom_flag"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"gif_ids"</span>: <span class="string">""</span>,</div><div class="line">        <span class="attr">"is_show_bulletin"</span>: <span class="number">2</span>,</div><div class="line">        <span class="attr">"mblogtype"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"created_timestamp"</span>: <span class="number">1477819372</span>,</div><div class="line">        <span class="attr">"bid"</span>: <span class="string">"Eff5Jjg4e"</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过上面的数据结构，很容易找到想要获取的数据：</p>
<ul>
<li>微博 ID</li>
<li>微博内容</li>
<li>微博创建时间</li>
<li>被转发的微博内容</li>
<li>被转发的微博创建时间</li>
<li>微博内容里文章链接地址</li>
<li>微博原始 URL 地址（这个在从上面 JSON 里看不出来，后续会介绍）</li>
</ul>
<p>通过上面的数据，获得一个叫 <code>mblog</code> 字段，这里把它描述成一个对象 <code>weibo</code>，那么上面要获取的数据为(伪代码)：</p>
<p>微博 ID ：<code>weibo.id</code><br>微博内容 ：<code>weibo.text</code><br>微博创建时间：<code>weibo.created_at</code><br>被转发的微博内容：<code>weibo.retweeted_status.text</code><br>被转发的微博创建时间：<code>weibo.retweeted_status.created_at</code><br>微博内容里文章链接地址：从 <code>weibo.retweeted_status.text</code> 中获得</p>
<p>微博原始 URL 地址：</p>
<p>通过微博客户端找到微博详情，地址如下：<br><a href="http://weibo.com/5861126740/EewuvDAEv" target="_blank" rel="external">http://weibo.com/5861126740/EewuvDAEv</a></p>
<p>简化成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://weibo.com/XXXX/XXXX</div></pre></td></tr></table></figure>
<p>第 1 个 XXXX 很明显是当前微博发布者的 ID<br>第 2 个 XXXX 看例子中的 <code>EewuvDAEv</code> 和 JSON 数据结构的 <code>bid</code> 差不多，经过测试，果真就是这个。</p>
<p>OK 到这里就差一个程序猿敲代码了。</p>
<p>我们使用 Python 3 作为我们的程序语言，然后使用哪些库呢？</p>
<ol>
<li>要获取 <a href="http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1" target="_blank" rel="external">http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1</a> 里面的数据，我们得使用 <code>urllib</code> 库</li>
<li>要抓取 JSON 数据，我们得使用 <code>json</code> 库</li>
<li>微博内容里文章链接地址要从 <code>weibo.retweeted_status.text</code> 里获得，通过分析发现他在 <code>a</code> 标签里的 <code>data-url</code> 下，这里我们用到 <code>BeautifulSoup</code> 第三方库，上面的那两个库都是系统自带的，<code>BeautifulSoup</code> 库需要自己安装。</li>
</ol>
<h4 id="获取微博数据"><a href="#获取微博数据" class="headerlink" title="获取微博数据"></a>获取微博数据</h4><p>通过多次测试，发现有时直接调用上面的链接，有时会不稳定。还是在 header 里添加上 Cookie 吧，这样就能真实模拟浏览器了。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> Request</div><div class="line"></div><div class="line">url = <span class="string">"http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1"</span></div><div class="line">    </div><div class="line">header = &#123;</div><div class="line">            <span class="string">"User-Agent"</span> : <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36"</span>,</div><div class="line">            <span class="string">"Connection"</span> : <span class="string">"keep-alive"</span>,</div><div class="line">            <span class="string">"Cache-Control"</span> : <span class="string">"max-age=0"</span>,</div><div class="line">            <span class="string">"Upgrade-Insecure-Requests"</span> : <span class="string">"1"</span>,</div><div class="line">            <span class="string">"Accept"</span> :<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>,</div><div class="line">            <span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4,ja;q=0.2"</span>,</div><div class="line">            <span class="string">"Cookie"</span>: <span class="string">"这里填写你自己的 Cookie(下面有介绍，如何获取)"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">request = Request(url,<span class="keyword">None</span>,header)</div><div class="line">response = urlopen(request,timeout=<span class="number">10</span>)</div><div class="line">    </div><div class="line">print(response.read())</div></pre></td></tr></table></figure>
<p>注：</p>
<p>如何获取自己的 Cookie？</p>
<ol>
<li>先在 Chrome 浏览器里登录微博</li>
<li>打开链接  <a href="http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1" target="_blank" rel="external">http://m.weibo.cn/page/json?containerid=1005052088894917_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=1</a></li>
<li>cmd + option + i 打开开发者工具，找到上面链接，即可在 Header 里找到 Cookie，贴到上面就可以了。 </li>
</ol>
<h4 id="解析-JSON-数据"><a href="#解析-JSON-数据" class="headerlink" title="解析 JSON 数据"></a>解析 JSON 数据</h4><p>引入 <code>json</code> 库，直接贴代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line"></div><div class="line">jsonObj = json.loads(response.read().decode(<span class="string">"utf-8"</span>))</div><div class="line">weibo = jsonObj.get(<span class="string">"mblog"</span>) <span class="comment"># 这里只是列出如何使用 json 库，并不是上面真实 JSON 数据</span></div><div class="line">text = weibo.get(<span class="string">"text"</span>)</div></pre></td></tr></table></figure>
<h4 id="获取文章链接地址"><a href="#获取文章链接地址" class="headerlink" title="获取文章链接地址"></a>获取文章链接地址</h4><p>这里我们用到 BeautifulSoup 这个库,我们需要自己手动安装：</p>
<p>1.创建虚拟环境并激活</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir weibo</div><div class="line">cd weibo</div><div class="line">pyvenv venv</div><div class="line">source venv/bin/activate</div></pre></td></tr></table></figure>
<p>2.使用 pip 安装 BeautifulSoup</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install beautifulsoup4</div></pre></td></tr></table></figure>
<p>3.在 weibo.py 里引入 BeautifulSoup</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div></pre></td></tr></table></figure>
<p>通过 <code>weibo.get(&quot;text&quot;)</code> 获取微博内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">我写了新文章《2016年末闲谈iOS开发的未来》（ 分享自 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'/n/简书'</span>&gt;</span>@简书<span class="tag">&lt;/<span class="name">a</span>&gt;</span> ） <span class="tag">&lt;<span class="name">a</span> <span class="attr">data-url</span>=<span class="string">\</span>"<span class="attr">http:</span>//<span class="attr">t.cn</span>/<span class="attr">RVmxjs7</span>\" <span class="attr">href</span>=<span class="string">\</span>"<span class="attr">http:</span>//<span class="attr">media.weibo.cn</span>/<span class="attr">article</span>?<span class="attr">id</span>=<span class="string">2309614036183188449410&amp;object_id</span>=<span class="string">1022%3A2309614036183188449410&amp;url_type</span>=<span class="string">39&amp;object_type</span>=<span class="string">article&amp;pos</span>=<span class="string">1&amp;containerid</span>=<span class="string">&amp;\</span>" &gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">\</span>"<span class="attr">iconimg</span> <span class="attr">iconimg-xs</span>\"&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">\</span>"<span class="attr">http:</span>//<span class="attr">h5.sinaimg.cn</span>/<span class="attr">upload</span>/<span class="attr">2015</span>/<span class="attr">09</span>/<span class="attr">25</span>/<span class="attr">3</span>/<span class="attr">timeline_card_small_article_default.png</span>\"&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">\</span>"<span class="attr">surl-text</span>\"&gt;</span>2016年末闲谈iO...<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure>
<p>经过多次分析，<code>a</code> 标签里的 <code>data-url</code> 就是我们想要的数据，这个如何获得呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"></div><div class="line">bsObj = BeautifulSoup(weiboContent,<span class="string">"html.parser"</span>) </div><div class="line">articleData = bsObj.find(<span class="string">"i"</span>,&#123;<span class="string">"class"</span>:<span class="string">"iconimg iconimg-xs"</span>&#125;) <span class="comment"># 微博中存在的文章链接</span></div><div class="line"><span class="keyword">if</span> articleData <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">    articleURL = articleData.parent.get(<span class="string">"data-url"</span>)</div></pre></td></tr></table></figure>
<h2 id="清洗数据"><a href="#清洗数据" class="headerlink" title="清洗数据"></a>清洗数据</h2><p>要抓取的微博内容里（即 <code>weibo.text</code> 和 <code>weibo.retweeted_status.text</code>），有 HTML 标签，这个不需要，干掉。可以使用 正则表达式 来处理，得需要引入一个 <code>re</code> 系统库。</p>
<p>因为每天抓取前一天的微博数据，其他数据不要，要进行时间比对。要引入 <code>time</code> 系统库。</p>
<p>不是每条微博都要抓取，比如哪天大牛心情不好，发了一篇无关紧要的微博，这一条微博就不是我们想抓取的，这个怎么办？我这里做了个限制，只抓去 转发数 <code>&gt;= 20</code> 的微博，这样会去掉不少无关微博，即使抓取的微博不是技术相关的，也是可以看看的。</p>
<h4 id="去掉-HTML-标签"><a href="#去掉-HTML-标签" class="headerlink" title="去掉 HTML 标签"></a>去掉 HTML 标签</h4><p>直接上代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line"></div><div class="line">weiboContent = mblog.get(<span class="string">"text"</span>) <span class="comment"># 微博内容</span></div><div class="line">content = re.compile(<span class="string">r'&lt;[^&gt;]+&gt;'</span>,re.S).sub(<span class="string">''</span>, weiboContent)</div></pre></td></tr></table></figure>
<h4 id="仅抓取昨日微博数据"><a href="#仅抓取昨日微博数据" class="headerlink" title="仅抓取昨日微博数据"></a>仅抓取昨日微博数据</h4><p>分析 JSON 里 <code>created-at</code> 字段，格式无非就是以下几种：</p>
<ul>
<li>几分钟前 </li>
<li>几小时前 </li>
<li>今天 18:30 </li>
<li>10-27 21:27</li>
<li>2015-10-22 12:28</li>
</ul>
<p>我们需要的仅是昨天的微博。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line">currentYear = time.localtime().tm_year</div><div class="line">currentMonth = time.localtime().tm_mon</div><div class="line">currentDay = time.localtime().tm_mday</div><div class="line">    </div><div class="line"><span class="comment"># 注意下方这段代码 是放在循环里面的</span></div><div class="line"></div><div class="line">createdTime = mblog.get(<span class="string">"created_at"</span>) <span class="comment"># 微博创建时间</span></div><div class="line">timeArray = createdTime.split()</div><div class="line"><span class="keyword">if</span> timeArray[<span class="number">0</span>] == <span class="string">'今天'</span>:</div><div class="line">      <span class="keyword">continue</span></div><div class="line"><span class="keyword">if</span> len(timeArray) &lt;= <span class="number">1</span>:</div><div class="line">      <span class="keyword">continue</span></div><div class="line">yearMonthDayArray = timeArray[<span class="number">0</span>].split(<span class="string">'-'</span>)</div><div class="line">yearStr = currentYear</div><div class="line">monthStr = currentMonth</div><div class="line">dayStr = currentDay</div><div class="line"><span class="keyword">if</span> len(yearMonthDayArray) == <span class="number">3</span>:</div><div class="line">    yearStr = yearMonthDayArray[<span class="number">0</span>]</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    monthStr = yearMonthDayArray[<span class="number">0</span>]</div><div class="line">    dayStr = yearMonthDayArray[<span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="keyword">if</span> int(yearStr) &lt; currentYear <span class="keyword">or</span> int(monthStr) &lt; currentMonth <span class="keyword">or</span> int(dayStr) &lt; currentDay - <span class="number">1</span>:</div><div class="line">    <span class="keyword">return</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> int(dayStr) != currentDay - <span class="number">1</span>:</div><div class="line">     <span class="keyword">continue</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">     <span class="keyword">continue</span></div><div class="line">    </div><div class="line"><span class="comment"># 下方处理的数据才是我们要的微博数据</span></div><div class="line">weiboContent = mblog.get(<span class="string">"text"</span>) <span class="comment"># 微博内容</span></div></pre></td></tr></table></figure>
<h4 id="转发数-gt-20"><a href="#转发数-gt-20" class="headerlink" title="转发数 &gt; 20"></a>转发数 &gt; 20</h4><p>这里指的转发数是指 <strong>本条微博的转发数</strong> + <strong>本条微博所转发的原始微博的转发数</strong>，比较绕，请三思。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">weiboContent = mblog.get(<span class="string">"text"</span>) <span class="comment"># 微博内容</span></div><div class="line">repostsCount = mblog.get(<span class="string">"reposts_count"</span>) <span class="comment"># 微博转发数量</span></div><div class="line">retweeted_status = mblog.get(<span class="string">"retweeted_status"</span>) <span class="comment"># 转发的微博</span></div><div class="line">  </div><div class="line"><span class="keyword">if</span> retweeted_status <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: <span class="comment"># 没有转发微博</span></div><div class="line">    retweetedID = retweeted_status.get(<span class="string">"id"</span>) <span class="comment"># 转发的微博 ID</span></div><div class="line">    retweetedOriginContent = retweeted_status.get(<span class="string">"text"</span>) <span class="comment"># 转发的微博内容</span></div><div class="line">    retweetedWeiboRepostsCount = retweeted_status.get(<span class="string">"reposts_count"</span>) <span class="comment"># 转发的微博的转发数量</span></div><div class="line">            </div><div class="line">    <span class="keyword">if</span> retweetedWeiboRepostsCount <span class="keyword">is</span>  <span class="keyword">None</span> <span class="keyword">or</span> repostsCount <span class="keyword">is</span> <span class="keyword">None</span>:<span class="comment"># 此微博可能已被删除 故做此判断</span></div><div class="line">        <span class="keyword">continue</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> retweetedWeiboRepostsCount + repostsCount &gt; <span class="number">20</span>:</div><div class="line">            print(weiboContent,retweetedOriginContent)</div><div class="line">    <span class="keyword">else</span>: <span class="comment"># 原创微博</span></div><div class="line">        <span class="keyword">if</span> repostsCount <span class="keyword">is</span> <span class="keyword">None</span>: <span class="comment"># 此微博可能已被删除 故做此判断</span></div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> repostsCount &gt; <span class="number">20</span>:</div><div class="line">            print(weiboContent)</div></pre></td></tr></table></figure>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> Request</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_weibo</span><span class="params">(userWeiboID,pageIndex)</span>:</span></div><div class="line">    url = <span class="string">"http://m.weibo.cn/page/json?containerid=%s_-_WEIBO_SECOND_PROFILE_WEIBO&amp;page=%d"</span>%(userWeiboID,pageIndex)</div><div class="line"></div><div class="line">    currentYear = time.localtime().tm_year</div><div class="line">    currentMonth = time.localtime().tm_mon</div><div class="line">    currentDay = time.localtime().tm_mday</div><div class="line">    </div><div class="line">    yesterdayDateTime = <span class="string">"%d-%d"</span>%(time.localtime().tm_mon,time.localtime().tm_mday - <span class="number">1</span>)</div><div class="line">    </div><div class="line">    header = &#123;</div><div class="line">                <span class="string">"User-Agent"</span> : <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36"</span>,</div><div class="line">                <span class="string">"Connection"</span> : <span class="string">"keep-alive"</span>,</div><div class="line">                <span class="string">"Cache-Control"</span> : <span class="string">"max-age=0"</span>,</div><div class="line">                <span class="string">"Upgrade-Insecure-Requests"</span> : <span class="string">"1"</span>,</div><div class="line">                <span class="string">"Accept"</span> :<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span>,</div><div class="line">                <span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.8,en;q=0.6,zh-TW;q=0.4,ja;q=0.2"</span>,</div><div class="line">    <span class="string">"Cookie"</span>: <span class="string">"XXXX"</span></div><div class="line">    &#125;</div><div class="line">    request = Request(url,<span class="keyword">None</span>,header)</div><div class="line">    response = urlopen(request,timeout=<span class="number">10</span>)</div><div class="line"></div><div class="line">    jsonObj = json.loads(response.read().decode(<span class="string">"utf-8"</span>))</div><div class="line"></div><div class="line">    <span class="keyword">for</span> cards <span class="keyword">in</span> jsonObj.get(<span class="string">"cards"</span>):</div><div class="line">        card_group = cards.get(<span class="string">"card_group"</span>)</div><div class="line">        <span class="keyword">if</span> card_group <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            get_weibo(userWeiboID,pageIndex)</div><div class="line">            <span class="keyword">break</span></div><div class="line">        </div><div class="line">        <span class="keyword">for</span> cardGroup <span class="keyword">in</span> card_group:</div><div class="line">            <span class="keyword">if</span> cardGroup <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">                get_weibo(userWeiboID,pageIndex)</div><div class="line">                <span class="keyword">break</span></div><div class="line">            </div><div class="line">            mblog = cardGroup.get(<span class="string">"mblog"</span>) <span class="comment"># 微博</span></div><div class="line">            mblogID = mblog.get(<span class="string">"id"</span>) <span class="comment"># 微博 ID</span></div><div class="line">            originContent = mblog.get(<span class="string">"text"</span>) <span class="comment"># 微博 内容</span></div><div class="line">            content = re.compile(<span class="string">r'&lt;[^&gt;]+&gt;'</span>,re.S).sub(<span class="string">''</span>,originContent)</div><div class="line">            createdTime = mblog.get(<span class="string">"created_at"</span>) <span class="comment"># 微博创建时间</span></div><div class="line">            isTop = mblog.get(<span class="string">"isTop"</span>) </div><div class="line">            timeArray = createdTime.split()</div><div class="line">            <span class="keyword">if</span> timeArray[<span class="number">0</span>] == <span class="string">'今天'</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            <span class="keyword">if</span> len(timeArray) &lt;= <span class="number">1</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            yearMonthDayArray = timeArray[<span class="number">0</span>].split(<span class="string">'-'</span>)</div><div class="line">            yearStr = currentYear</div><div class="line">            monthStr = currentMonth</div><div class="line">            dayStr = currentDay</div><div class="line">            <span class="keyword">if</span> len(yearMonthDayArray) == <span class="number">3</span>:</div><div class="line">                yearStr = yearMonthDayArray[<span class="number">0</span>]</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                monthStr = yearMonthDayArray[<span class="number">0</span>]</div><div class="line">                dayStr = yearMonthDayArray[<span class="number">1</span>]</div><div class="line"></div><div class="line">            <span class="keyword">if</span> isTop <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">                <span class="keyword">if</span> int(yearStr) &lt; currentYear <span class="keyword">or</span> int(monthStr) &lt; currentMonth <span class="keyword">or</span> int(dayStr) &lt; currentDay - <span class="number">1</span>:</div><div class="line">                    <span class="keyword">return</span></div><div class="line"></div><div class="line">                <span class="keyword">if</span> int(dayStr) != currentDay - <span class="number">1</span>:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            </div><div class="line">            </div><div class="line">            repostsCount = mblog.get(<span class="string">"reposts_count"</span>) <span class="comment"># 微博转发数量</span></div><div class="line">            bid = mblog.get(<span class="string">"bid"</span>)</div><div class="line">            retweeted_status = mblog.get(<span class="string">"retweeted_status"</span>) <span class="comment"># 转发的微博</span></div><div class="line"></div><div class="line">            weiboURL = <span class="string">"http://weibo.com/%s/%s"</span>%(userWeiboID[<span class="number">6</span>:],bid)</div><div class="line">        </div><div class="line">            <span class="keyword">if</span> retweeted_status <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: <span class="comment"># 有转发的微博</span></div><div class="line">                retweetedID = retweeted_status.get(<span class="string">"id"</span>) <span class="comment"># 转发的微博 ID</span></div><div class="line">                retweetedOriginContent = retweeted_status.get(<span class="string">"text"</span>) <span class="comment"># 转发的微博内容</span></div><div class="line">                retweetedContent = re.compile(<span class="string">r'&lt;[^&gt;]+&gt;'</span>,re.S).sub(<span class="string">''</span>,retweetedOriginContent)</div><div class="line">                retweetedCreatedTime = retweeted_status.get(<span class="string">"created_at"</span>) <span class="comment"># 转发的微博创建时间</span></div><div class="line">                retweetedWeiboRepostsCount = retweeted_status.get(<span class="string">"reposts_count"</span>) <span class="comment"># 转发的微博的转发数量</span></div><div class="line">            </div><div class="line">                <span class="keyword">if</span> retweetedWeiboRepostsCount <span class="keyword">is</span>  <span class="keyword">None</span> <span class="keyword">or</span> repostsCount <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">    </div><div class="line">                <span class="keyword">if</span> retweetedWeiboRepostsCount + repostsCount &gt; <span class="number">20</span>:</div><div class="line">                    bsObj = BeautifulSoup(retweetedOriginContent,<span class="string">"html.parser"</span>)</div><div class="line">                    articlesData = bsObj.find_all(<span class="string">"i"</span>,&#123;<span class="string">"class"</span>:<span class="string">"iconimg iconimg-xs"</span>&#125;) <span class="comment"># 微博中存在的文章链接</span></div><div class="line">                    print(createdTime,<span class="string">'\n'</span>)</div><div class="line">                    print(retweetedCreatedTime,<span class="string">'\n'</span>)</div><div class="line">                    print(content,<span class="string">'\n'</span>,retweetedContent,<span class="string">'\n\n'</span>)</div><div class="line">                    <span class="keyword">if</span> articlesData <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">                        <span class="keyword">for</span> articleInfo <span class="keyword">in</span> articlesData:</div><div class="line">                            articleURL = articleInfo.parent.get(<span class="string">"data-url"</span>)</div><div class="line">                            print(<span class="string">'链接地址：'</span>,articleURL,<span class="string">'\n'</span>)</div><div class="line">                    print(<span class="string">'\n\n微博地址：'</span>,weiboURL,<span class="string">'\n\n\n\n'</span>)</div><div class="line">                        </div><div class="line">            <span class="keyword">else</span>: <span class="comment">#原创微博</span></div><div class="line">                <span class="keyword">if</span> repostsCount <span class="keyword">is</span> <span class="keyword">None</span>: <span class="comment"># 此微博可能已被删除 故做此判断</span></div><div class="line">                    <span class="keyword">continue</span></div><div class="line"></div><div class="line">                <span class="keyword">if</span> repostsCount &gt; <span class="number">20</span>:</div><div class="line">                    bsObj = BeautifulSoup(originContent,<span class="string">"html.parser"</span>)</div><div class="line">                    articlesData = bsObj.find_all(<span class="string">"i"</span>,&#123;<span class="string">"class"</span>:<span class="string">"iconimg iconimg-xs"</span>&#125;) <span class="comment"># 微博中存在的文章链接</span></div><div class="line">                    print(createdTime,<span class="string">'\n'</span>)</div><div class="line">                    print(content,<span class="string">'\n\n'</span>)</div><div class="line">                    <span class="keyword">if</span> articlesData <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">                        <span class="keyword">for</span> articleInfo <span class="keyword">in</span> articlesData:</div><div class="line">                            articleURL = articleInfo.parent.get(<span class="string">"data-url"</span>)</div><div class="line">                            print(<span class="string">'链接地址：'</span>,articleURL,<span class="string">'\n'</span>)</div><div class="line">                    print(<span class="string">'\n\n微博地址：'</span>,weiboURL,<span class="string">'\n\n\n\n'</span>)</div><div class="line">                        </div><div class="line">    pageIndex = pageIndex + <span class="number">1</span></div><div class="line">    get_weibo(userWeiboID,pageIndex)</div><div class="line"></div><div class="line"></div><div class="line">userWeiboDic = &#123;</div><div class="line">    <span class="string">"唐巧_boy"</span> : <span class="string">"1005051708947107"</span>,</div><div class="line">    <span class="string">"onevcat"</span> : <span class="string">"1005052210132365"</span>,</div><div class="line">    <span class="string">"iOS程序犭袁"</span> : <span class="string">"1005051692391497"</span>,</div><div class="line">    <span class="string">"没故事的卓同学"</span> : <span class="string">"1005051926303682"</span>,</div><div class="line">    <span class="string">"叶孤城___"</span> : <span class="string">"1005051438670852"</span>,</div><div class="line">    <span class="string">"我就叫Sunny怎么了"</span> : <span class="string">"1005051364395395"</span>,</div><div class="line">    <span class="string">"nixzhu"</span> : <span class="string">"1005052076580237"</span>,</div><div class="line">    <span class="string">"ibireme"</span> : <span class="string">"1005052477831984"</span>,</div><div class="line">    <span class="string">"bang"</span> : <span class="string">"1005051642409481"</span>,</div><div class="line">    <span class="string">"KITTEN-YANG"</span> : <span class="string">"1005052854163804"</span>,</div><div class="line">    <span class="string">"StackOverflowError"</span> : <span class="string">"1005051765732340"</span>,</div><div class="line">    <span class="string">"图拉鼎"</span> : <span class="string">"1005051846569133"</span>,</div><div class="line">    <span class="string">"lzwjava"</span> : <span class="string">"1005051695406573"</span>,</div><div class="line">    <span class="string">"董宝君_iOS"</span> : <span class="string">"1005053026163601"</span>,</div><div class="line">    <span class="string">"移动开发前线"</span> : <span class="string">"1005055861126740"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> name,weiboID <span class="keyword">in</span> userWeiboDic.items():</div><div class="line">    print(<span class="string">"-------正在爬取 %s 的微博------"</span>%name)</div><div class="line">    get_weibo(weiboID,<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>爬取结果：</p>
<p><img src="/images/weibo_spider/0.png" alt="微博爬虫"></p>
<p>未完待续 ……</p>
<p>后续功能：</p>
<ul>
<li>将数据存入数据库</li>
<li>生成邮件模板</li>
<li>定时任务。定时抓取，定时发送邮件</li>
<li>自动读取 Chrome 里 Cookie</li>
<li>使用更高级的第三方库</li>
<li>使用 Scrap 爬虫</li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/2016/08/21/一个猿的自娱自乐/" class="next">下一篇</a></div><div data-thread-key="2016/10/30/每日爬取技术大牛微博生成邮件（一）/" data-title="每日爬取技术大牛微博生成邮件（一）" data-url="http://iYiming.me/2016/10/30/每日爬取技术大牛微博生成邮件（一）/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?3cec0b24b46b86302d1aa3b050d4668f";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script></body></html>