<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 小程序开发 · 一鸣的博客</title><meta name="description" content="小程序开发 - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">小程序开发</h1><div class="post-info">2017年3月20日</div><div class="post-content"><p>前段时间完成了公司小程序的开发，一个做 iOS App 的人，做起小程序的感觉就是，JS 写原生 App 也可以这么流畅，原生开发者要丢饭碗啦！原先也研究过一段时间的 React Native，因为列表滚动太卡顿的性能限制，也就失去了研究的兴趣，现在看小程序，别有一番滋味。</p>
<p>也还是在前几天，Apple 封杀了 JSPatch。微博里流传的是这样一则笑话：“Apple: 听说 iOS 开发者没人要了？”。 不管历史的车轮怎么转，小程序很值得原生开发者学习下。</p>
<a id="more"></a>
<p>断断续续，写了好几篇小程序的文章，感觉自己写的东西都在微信开发者文档里，就一扔再扔。反复几次，终于有了这么一篇文章。不说基础，直接上 Demo：</p>
<p><img src="/images/wechat-small-app/01.gif" alt="效果"></p>
<p>从 4 个地方说起：</p>
<ul>
<li>布局</li>
<li>模板</li>
<li>请求接口数据</li>
<li>页面传值</li>
<li>下拉刷新 上拉加载</li>
<li>分享</li>
</ul>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>采用 Flex 布局，对于 Flex 布局可以参考阮一峰老师的这两篇文章：</p>
<p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="external">Flex 布局教程：语法篇</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-examples.html" target="_blank" rel="external">Flex 布局教程：实例篇</a>  </p>
<p>我们的页面每一行是长这个样子的（有时候会有图片 1 张或者多张，有时会没有）：</p>
<p><img src="/images/wechat-small-app/02.jpeg" alt="长图片"></p>
<p>页面结构代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"postItem"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"userAvatar"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; userAvatar &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"rightView"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"userName"</span>&gt;</span>&#123;&#123; user_nick_name &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"postTitle"</span>&gt;</span></div><div class="line">      &#123;&#123; title &#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"postContent"</span>&gt;</span></div><div class="line">      &#123;&#123; subject &#125;&#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"imagesBgView"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"imageBgView"</span> <span class="attr">wx:key</span>=<span class="string">"property"</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123; imageList &#125;&#125;"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; item &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"postImage"</span> <span class="attr">catchtap</span>=<span class="string">'imageTapped'</span> <span class="attr">data-images</span>=<span class="string">"&#123;&#123; imageList &#125;&#125;"</span> <span class="attr">data-current</span>=<span class="string">"&#123;&#123; item &#125;&#125;"</span> <span class="attr">mode</span>=<span class="string">'aspectFill'</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"postMoreInfoView"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"postTimeText"</span>&gt;</span>&#123;&#123; last_reply_date &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"postTypeText"</span>&gt;</span>&#123;&#123; board_name &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"postViewCountCommentBgView"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"http://iyiming-10052166.cos.myqcloud.com/eye.png"</span> <span class="attr">class</span>=<span class="string">"eyeImage"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"viewCountCommentCountText"</span>&gt;</span>&#123;&#123; hits &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"http://iyiming-10052166.cos.myqcloud.com/comment.png"</span> <span class="attr">class</span>=<span class="string">"commentImage"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"viewCountCommentCountText"</span>&gt;</span>&#123;&#123; replies &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"splitLineView"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></div></pre></td></tr></table></figure>
<p>页面样式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.postItem</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex; </div><div class="line">    <span class="attribute">flex-direction</span>: row;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.userAvatar</span> &#123;</div><div class="line">    <span class="attribute">width</span>:<span class="number">80</span>rpx; </div><div class="line">    <span class="attribute">height</span>:<span class="number">80</span>rpx;</div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</div><div class="line">    <span class="attribute">margin-left</span>:<span class="number">20</span>rpx;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</div><div class="line">    <span class="attribute">background-color</span>:<span class="number">#F3F3F3</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.userName</span> &#123;</div><div class="line">    <span class="attribute">color</span>: <span class="number">#78C51C</span>; </div><div class="line">    <span class="attribute">font-size</span>:<span class="number">32</span>rpx;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.rightView</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex; </div><div class="line">    <span class="attribute">flex-direction</span>: column; </div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">10</span>rpx;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postTitle</span> &#123;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">32</span>rpx; </div><div class="line">    <span class="attribute">margin-right</span>: <span class="number">20</span>rpx; </div><div class="line">    <span class="attribute">margin-top</span>: -<span class="number">20</span>rpx;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postContent</span> &#123;</div><div class="line">    <span class="attribute">margin-top</span>: -<span class="number">10</span>rpx; </div><div class="line">    <span class="attribute">font-size</span>: <span class="number">28</span>rpx; </div><div class="line">    <span class="attribute">margin-right</span>: <span class="number">20</span>rpx; </div><div class="line">    <span class="attribute">line-height</span>: <span class="number">38</span>rpx; </div><div class="line">    <span class="attribute">color</span>: <span class="number">#393939</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.imagesBgView</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex; </div><div class="line">    <span class="attribute">flex-wrap</span>: wrap</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.imageBgView</span> &#123;</div><div class="line">    <span class="attribute">margin-right</span>: <span class="number">20</span>rpx;</div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">10px</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postImage</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">190</span>rpx; </div><div class="line">    <span class="attribute">height</span>: <span class="number">190</span>rpx;</div><div class="line">    <span class="attribute">background-color</span>:<span class="number">#F3F3F3</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postMoreInfoView</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">    <span class="attribute">justify-content</span>: space-between;</div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">10</span>rpx</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postTimeText</span> &#123;</div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx; </div><div class="line">    <span class="attribute">font-size</span>: <span class="number">22</span>rpx;</div><div class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postTypeText</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>:<span class="number">10</span>rpx;</div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx; </div><div class="line">    <span class="attribute">font-size</span>: <span class="number">22</span>rpx;</div><div class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.postViewCountCommentBgView</span> &#123;</div><div class="line">    <span class="attribute">margin-right</span>: <span class="number">28</span>rpx;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.eyeImage</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">26</span>rpx; </div><div class="line">    <span class="attribute">height</span>: <span class="number">18</span>rpx;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.viewCountCommentCountText</span> &#123;</div><div class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx; </div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">10</span>rpx; </div><div class="line">    <span class="attribute">font-size</span>: <span class="number">22</span>rpx;</div><div class="line">    <span class="attribute">color</span>: <span class="number">#999999</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.commentImage</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">26</span>rpx; </div><div class="line">    <span class="attribute">height</span>: <span class="number">18</span>rpx;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">10</span>rpx;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.addPost</span> &#123;</div><div class="line">    <span class="attribute">position</span>: fixed; </div><div class="line">    <span class="attribute">bottom</span>: <span class="number">30</span>rpx;</div><div class="line">    <span class="attribute">right</span>: <span class="number">30</span>rpx;</div><div class="line">    <span class="attribute">width</span>: <span class="number">90</span>rpx;</div><div class="line">    <span class="attribute">height</span>: <span class="number">90</span>rpx</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p>对于我们重复的每一行，微信提供了模板的功能，让我们更方便的重用代码，具体用法如下：</p>
<p>在 templates 文件夹里，添加一个文件夹 postItem 并创建文件：postItem.wxml。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">"postItem"</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在使用的地方，需要先引入再使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">"../../templates/postItem/postItem.wxml"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">"postItem"</span> <span class="attr">data</span>=<span class="string">"&#123;&#123; ...postInfo &#125;&#125;"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="请求接口数据"><a href="#请求接口数据" class="headerlink" title="请求接口数据"></a>请求接口数据</h2><p>微信提供了很方便的接口请求方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">wx.request(&#123;</div><div class="line">  url: <span class="string">'https://URL'</span>,</div><div class="line">  data: &#123;&#125;,</div><div class="line">  method: <span class="string">'GET'</span>, <span class="comment">// OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT</span></div><div class="line">  <span class="comment">// header: &#123;&#125;, // 设置请求的 header</span></div><div class="line">  success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</div><div class="line">    <span class="comment">// success</span></div><div class="line">  &#125;,</div><div class="line">  fail: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// fail</span></div><div class="line">  &#125;,</div><div class="line">  complete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// complete</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>返回的数据都存在 <code>res.data</code> 里。</p>
<h2 id="页面传值"><a href="#页面传值" class="headerlink" title="页面传值"></a>页面传值</h2><p>从 A 页面传值到 B 页面，这个很简单：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wx.navigateTo(&#123;</div><div class="line">    url: <span class="string">'../postDetail/postDetail?board_id='</span> + boardID + <span class="string">'&amp;topic_id='</span> + topicID</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<p>从 A 页面导航到 B 页面，B 页面点击按钮后，需要传值给 A 页面，可以在 B 页面将数据保存起来，再在 A 页面中获取。这样做显然不太好，有没有更好的办法？我这里使用了页面栈：</p>
<p>比如说页面 B 的某个 item 点击时，可以使用下面的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">itemTapped: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">   <span class="keyword">var</span> item = e.currentTarget.dataset.info</div><div class="line"></div><div class="line">   <span class="keyword">var</span> pages = getCurrentPages();</div><div class="line">   <span class="keyword">var</span> currPage = pages[pages.length - <span class="number">1</span>];   <span class="comment">//当前页面</span></div><div class="line">   <span class="keyword">var</span> prevPage = pages[pages.length - <span class="number">2</span>];  <span class="comment">//上一个页面</span></div><div class="line"></div><div class="line">   <span class="comment">//直接调用上一个页面的setData()方法，把数据存到上一个页面中去</span></div><div class="line">   prevPage.setData(&#123;</div><div class="line">     plate: item</div><div class="line">   &#125;)</div><div class="line">   <span class="built_in">console</span>.log(prevPage.data)</div><div class="line">   wx.navigateBack()</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>在 gif 图这个例子里，我们有个预览图片的功能，点击某张图片进入图片预览，左右滑动，查看上一张下一张图片，先来看看微信给提供的预览图片的 API：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">wx.previewImage(&#123;</div><div class="line">  <span class="comment">// current: 'String', // 当前显示图片的链接，不填则默认为 urls 的第一张</span></div><div class="line">  urls: [StringArray],</div><div class="line">  success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</div><div class="line">    <span class="comment">// success</span></div><div class="line">  &#125;,</div><div class="line">  fail: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// fail</span></div><div class="line">  &#125;,</div><div class="line">  complete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// complete</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>点击图片时，我们需要传入当前点击的图片，还需要传入图片数组：</p>
<p>wxml 内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; item &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"postImage"</span> <span class="attr">catchtap</span>=<span class="string">'imageTapped'</span> <span class="attr">data-images</span>=<span class="string">"&#123;&#123; imageList &#125;&#125;"</span> <span class="attr">data-current</span>=<span class="string">"&#123;&#123; item &#125;&#125;"</span> <span class="attr">mode</span>=<span class="string">'aspectFill'</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>js 内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">imageTapped: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    wx.previewImage(&#123;</div><div class="line">      current: e.currentTarget.dataset.current, <span class="comment">// 当前图片</span></div><div class="line">      urls: e.currentTarget.dataset.images <span class="comment">// 图片数组</span></div><div class="line">    &#125;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="下拉刷新-上拉加载"><a href="#下拉刷新-上拉加载" class="headerlink" title="下拉刷新 上拉加载"></a>下拉刷新 上拉加载</h2><p>对于下拉刷新、上拉加载，微信有直接给我们使用的 API：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">onPullDownRefresh: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="comment">// 上拉刷新</span></div><div class="line"> &#125;,</div><div class="line"> onReachBottom: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// 到达底部 实现上拉加载</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>一开始，我没有弄出这种上拉刷新效果，使用的 <code>scroll-view</code> 代替的，虽然能达到目的。体验不是很好走，了些弯路，还是换成了上面的这种方式，但是这里有一个小小的坑：</p>
<ol>
<li>在要实现上拉刷新页面的 json 文件里，添加 <code>&quot;enablePullDownRefresh&quot;: true</code></li>
<li>app.json 文件里 <code>window</code> 里要把  <code>backgroundTextStyle</code> 设置为 <code>dark</code>。要不和默认的白色背景都是白色，看不出来是下拉刷新，这个就是上面所说的坑。</li>
</ol>
<p>知道上面的两点，就能很好的实现下拉刷新。下拉加载顺其自然。</p>
<h2 id="分享"><a href="#分享" class="headerlink" title="分享"></a>分享</h2><p>要为某个页面实现分享功能，在页面的 js 文件里添加如下代码就可以了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Page(&#123;</div><div class="line">  onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      title: <span class="string">'自定义分享标题'</span>,</div><div class="line">      path: <span class="string">'/page/user?id=123'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>注意下路径，写对就好了。</p>
<p>另外微信阅读里有本《微信小程序入门指南》值得初学者看下，整体上讲的很细。小程序审核现在还很严格，要各种良民证。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2017/03/04/Fastlane-使用总结/" class="next">下一篇</a></div><div data-thread-key="2017/03/20/小程序开发/" data-title="小程序开发" data-url="http://iYiming.me/2017/03/20/小程序开发/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2017 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?3cec0b24b46b86302d1aa3b050d4668f";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script></body></html>