<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> POP 动画 · 一鸣的博客</title><meta name="description" content="POP 动画 - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">POP 动画</h1><div class="post-info">2015年6月28日</div><div class="post-content"><p>前段时间看了些，动画方面的文章，有一个很不错的教程：<a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques" target="_blank" rel="external">iOS-Core-Animation-Advanced-Techniques</a>，看会这个动画方面基本上差不多了，剩下的就是举一反三了。</p>
<p>疏于原先没有太过关注 Facebook 的 <a href="https://github.com/facebook/pop" target="_blank" rel="external">POP 动画引擎</a> ,做的效果这么好，于是就研究了下，找到了些几篇很好的文章：</p>
<p>POP 使用指南：  </p>
<p><a href="http://geeklu.com/2014/05/facebook-pop-usage/" target="_blank" rel="external">http://geeklu.com/2014/05/facebook-pop-usage/</a></p>
<p>很好的 POP 示例教程:</p>
<p><a href="https://github.com/schneiderandre/popping" target="_blank" rel="external">https://github.com/schneiderandre/popping</a><br><a href="https://github.com/kejinlu/facebook-pop-sample" target="_blank" rel="external">https://github.com/kejinlu/facebook-pop-sample</a></p>
<p>上面都是 Objective-C 写的，况且 Swift 出来已经一年了，由于公司项目一直使用 Objective-C，Swift 也得加强学习，故以后做 Demo 就用 Swift 了。</p>
<p>OK，那就仿 Popping ,用 Swift 写一个 POP 动画：SwiftPopping 。效果如下：</p>
<p><img src="/images/POP/POP1.gif" alt="POP"></p>
<h2 id="桥接"><a href="#桥接" class="headerlink" title="桥接"></a>桥接</h2><p>POP 动画引擎是用 Objective-C 写的，想要用在 Swift 项目中，需要用到桥接。  </p>
<p>开始桥接项目：前提是创建了 SwiftPopping 项目并且添加了 POP。</p>
<p>第一步：创建桥接文件：SwiftPopping-Bridging-Header.h<br>第二步：在 SwiftPopping-Bridging-Header.h 文件中写入：<code>#import &lt;pop/POP.h&gt;</code><br>第三步：详见下图：</p>
<p><img src="/images/POP/POP2.jpg" alt="POP"></p>
<p>需要注意的地方就是 1 中 <code>SwiftPopping-Bridging-Header.h</code> 所在项目的位置。</p>
<p>OK ,编译运行，成功！</p>
<p>如果想在 Objective-C 项目中调用 Swift 代码，可以参考下面的文章：  </p>
<p><a href="http://www.shimingwei.com/iOS/OC_Use_Swift.html" target="_blank" rel="external">http://www.shimingwei.com/iOS/OC_Use_Swift.html</a></p>
<h2 id="创建按钮-FlatButton"><a href="#创建按钮-FlatButton" class="headerlink" title="创建按钮 FlatButton"></a>创建按钮 FlatButton</h2><p>由于我们需要自定义 <code>UIButton</code> 的一些效果（点进去缩放、出来还原效果），故创建一个 <code>FlatButton</code> ，代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlatButton</span>: <span class="title">UIButton</span> </span>&#123;</div><div class="line">    <span class="comment">//标题居上下左右间距</span></div><div class="line">    <span class="keyword">override</span> <span class="keyword">var</span> titleEdgeInsets: <span class="type">UIEdgeInsets</span> &#123;</div><div class="line">        <span class="keyword">get</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="type">UIEdgeInsetsMake</span>(<span class="number">4.0</span>,<span class="number">28.0</span>,<span class="number">4.0</span>,<span class="number">28.0</span>)</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">set</span>&#123;</div><div class="line">            <span class="keyword">self</span>.titleEdgeInsets = newValue</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">button</span>() -&gt; <span class="title">FlatButton</span> </span>&#123;</div><div class="line">        <span class="keyword">var</span> button =  buttonWithType(<span class="type">UIButtonType</span>.<span class="type">Custom</span>) <span class="keyword">as</span>! <span class="type">FlatButton</span></div><div class="line">        <span class="keyword">return</span> button</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</div><div class="line">        setup()<span class="comment">//设置按钮</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(coder aDecoder: <span class="type">NSCoder</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//内容大小</span></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">intrinsicContentSize</span><span class="params">()</span></span> -&gt; <span class="type">CGSize</span> &#123;</div><div class="line">        <span class="keyword">var</span> size = <span class="keyword">super</span>.intrinsicContentSize()</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="type">CGSizeMake</span>(size.width + <span class="keyword">self</span>.titleEdgeInsets.<span class="keyword">left</span> + <span class="keyword">self</span>.titleEdgeInsets.<span class="keyword">right</span>,</div><div class="line">                size.height + <span class="keyword">self</span>.titleEdgeInsets.top + <span class="keyword">self</span>.titleEdgeInsets.bottom)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    设置按钮</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.backgroundColor = <span class="keyword">self</span>.tintColor;</div><div class="line">        <span class="keyword">self</span>.layer.cornerRadius = <span class="number">4.0</span></div><div class="line">        <span class="keyword">self</span>.setTitleColor(<span class="type">UIColor</span>.whiteColor(), forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line">        <span class="keyword">self</span>.titleLabel?.font = <span class="type">UIFont</span>(name: <span class="string">"Avenir-Medium"</span>, size: <span class="number">22</span>)</div><div class="line"></div><div class="line">        <span class="comment">//添加事件</span></div><div class="line">        <span class="keyword">self</span>.addTarget(<span class="keyword">self</span>, action: <span class="string">"scaleToSmall"</span>, forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchDown</span> | <span class="type">UIControlEvents</span>.<span class="type">TouchDragEnter</span>)</div><div class="line">        <span class="keyword">self</span>.addTarget(<span class="keyword">self</span>, action: <span class="string">"scaleAnimation"</span>, forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchUpInside</span>)</div><div class="line">        <span class="keyword">self</span>.addTarget(<span class="keyword">self</span>, action: <span class="string">"scaleToDefault"</span>, forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchDragExit</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//缩小</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scaleToSmall</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> scaleAnimation = <span class="type">POPBasicAnimation</span>(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleAnimation.toValue = <span class="type">NSValue</span>(<span class="type">CGPoint</span>:<span class="type">CGPointMake</span>(<span class="number">0.95</span>, <span class="number">0.95</span>))</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.layer.pop_addAnimation(scaleAnimation, forKey: <span class="string">"scaleToSmallAnimation"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//还原</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scaleToDefault</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> scaleAnimation = <span class="type">POPBasicAnimation</span>(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleAnimation.toValue = <span class="type">NSValue</span>(<span class="type">CGPoint</span>:<span class="type">CGPointMake</span>(<span class="number">1</span>, <span class="number">1</span>))</div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.layer.pop_addAnimation(scaleAnimation, forKey: <span class="string">"scaleToDefaultAnimation"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//动画</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">scaleAnimation</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> scaleAnimation = <span class="type">POPSpringAnimation</span>(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleAnimation.toValue = <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPointMake</span>(<span class="number">1.0</span>, <span class="number">1.0</span>))</div><div class="line">        scaleAnimation.velocity = <span class="type">NSValue</span>(<span class="type">CGPoint</span>:<span class="type">CGPointMake</span>(<span class="number">3.0</span>, <span class="number">3.0</span>))</div><div class="line">        scaleAnimation.springBounciness = <span class="number">18.0</span></div><div class="line">        </div><div class="line">        <span class="keyword">self</span>.layer.pop_addAnimation(scaleAnimation, forKey: <span class="string">"scaleAnimation"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="创建-ButtonViewController"><a href="#创建-ButtonViewController" class="headerlink" title="创建 ButtonViewController"></a>创建 ButtonViewController</h2><p>用于实现我们 GIF 图的效果。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ButtonViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> flatButton = <span class="type">FlatButton</span>.button()<span class="comment">//按钮</span></div><div class="line">    <span class="keyword">var</span> errorLabel = <span class="type">UILabel</span>()<span class="comment">//错误标签</span></div><div class="line">    <span class="keyword">var</span> activityIndicatorView = <span class="type">UIActivityIndicatorView</span>(activityIndicatorStyle: <span class="type">UIActivityIndicatorViewStyle</span>.<span class="type">Gray</span>)<span class="comment">//导航栏右侧Item</span></div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line"></div><div class="line">        <span class="comment">// Do any additional setup after loading the view.</span></div><div class="line"></div><div class="line">        addButton()<span class="comment">//添加按钮</span></div><div class="line">        addLabel()<span class="comment">//添加标签</span></div><div class="line">        addActivityIndicatorView()<span class="comment">//添加活动指示视图</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewWillDisappear(animated)</div><div class="line"></div><div class="line">        errorLabel.layer.transform = <span class="type">CATransform3DMakeScale</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</div><div class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    添加按钮</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addButton</span><span class="params">()</span></span>&#123;</div><div class="line">        flatButton.backgroundColor = <span class="type">UIColor</span>(red: <span class="number">52</span>/<span class="number">255.0</span>, green: <span class="number">152</span>/<span class="number">255.0</span>, blue: <span class="number">219</span>/<span class="number">255.0</span>, alpha: <span class="number">1.0</span>)</div><div class="line">        flatButton.setTitle(<span class="string">"Log in"</span>, forState: <span class="type">UIControlState</span>.<span class="type">Normal</span>)</div><div class="line">        flatButton.setTranslatesAutoresizingMaskIntoConstraints(<span class="literal">false</span>)</div><div class="line">        flatButton.addTarget(<span class="keyword">self</span>, action: <span class="string">"touchUpInside:"</span>, forControlEvents: <span class="type">UIControlEvents</span>.<span class="type">TouchUpInside</span>)</div><div class="line">        view.addSubview(flatButton)</div><div class="line"></div><div class="line">        <span class="comment">//添加约束</span></div><div class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: flatButton, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterX</span>, relatedBy: <span class="type">NSLayoutRelation</span>.<span class="type">Equal</span>, toItem: view, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterX</span>, multiplier: <span class="number">1</span>, constant: <span class="number">0.0</span>))</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: flatButton, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterY</span>, relatedBy: <span class="type">NSLayoutRelation</span>.<span class="type">Equal</span>, toItem: view, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterY</span>, multiplier: <span class="number">1</span>, constant: <span class="number">0.0</span>))</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    添加标签</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addLabel</span><span class="params">()</span></span>&#123;</div><div class="line">        errorLabel.font = <span class="type">UIFont</span>(name: <span class="string">"Avenir-Light"</span>, size: <span class="number">18</span>)</div><div class="line">        errorLabel.textColor = <span class="type">UIColor</span>(red: <span class="number">231</span>/<span class="number">255.0</span>, green: <span class="number">76</span>/<span class="number">255.0</span>, blue: <span class="number">60</span>/<span class="number">255.0</span>, alpha: <span class="number">1.0</span>)</div><div class="line">        errorLabel.setTranslatesAutoresizingMaskIntoConstraints(<span class="literal">false</span>)</div><div class="line">        errorLabel.text = <span class="string">"Just a serious login error."</span></div><div class="line">        errorLabel.textAlignment = <span class="type">NSTextAlignment</span>.<span class="type">Center</span></div><div class="line">        view.insertSubview(errorLabel, belowSubview: flatButton)</div><div class="line"></div><div class="line">        <span class="comment">//添加约束</span></div><div class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: errorLabel, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterX</span>, relatedBy: <span class="type">NSLayoutRelation</span>.<span class="type">Equal</span>, toItem: flatButton, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterX</span>, multiplier: <span class="number">1</span>, constant: <span class="number">0.0</span>))</div><div class="line"></div><div class="line">        <span class="keyword">self</span>.view.addConstraint(<span class="type">NSLayoutConstraint</span>(item: errorLabel, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterY</span>, relatedBy: <span class="type">NSLayoutRelation</span>.<span class="type">Equal</span>, toItem: flatButton, attribute: <span class="type">NSLayoutAttribute</span>.<span class="type">CenterY</span>, multiplier: <span class="number">1</span>, constant: <span class="number">0.0</span>))</div><div class="line"></div><div class="line">        errorLabel.layer.transform = <span class="type">CATransform3DMakeScale</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    添加活动指示图</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addActivityIndicatorView</span><span class="params">()</span></span>&#123;</div><div class="line">        activityIndicatorView.hidesWhenStopped = <span class="literal">true</span></div><div class="line">        <span class="keyword">self</span>.navigationItem.rightBarButtonItem = <span class="type">UIBarButtonItem</span>(customView: activityIndicatorView)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    按钮点击时</div><div class="line"></div><div class="line">    :param: button 按钮</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">touchUpInside</span><span class="params">(button: FlatButton)</span></span>&#123;</div><div class="line">        button.userInteractionEnabled = <span class="literal">false</span></div><div class="line">        activityIndicatorView.startAnimating()</div><div class="line">        hiddenErrorLabel()</div><div class="line"></div><div class="line">        <span class="keyword">let</span> delayTime = dispatch_time(<span class="type">DISPATCH_TIME_NOW</span>,</div><div class="line">        <span class="type">Int64</span>(<span class="number">1</span> * <span class="type">Double</span>(<span class="type">NSEC_PER_SEC</span>)))</div><div class="line">        dispatch_after(delayTime, dispatch_get_main_queue()) &#123;</div><div class="line">            <span class="keyword">self</span>.shakeFlatButton()</div><div class="line">            <span class="keyword">self</span>.showErrorLabel()</div><div class="line">            <span class="keyword">self</span>.activityIndicatorView.stopAnimating()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    摇晃按钮</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">shakeFlatButton</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">var</span> shakeSpringAnimation = <span class="type">POPSpringAnimation</span>(propertyNamed: kPOPLayerPositionX)</div><div class="line">        shakeSpringAnimation.velocity = <span class="type">NSNumber</span>(float: <span class="number">2000.0</span>)</div><div class="line">        shakeSpringAnimation.springBounciness = <span class="number">20.0</span></div><div class="line">        shakeSpringAnimation.completionBlock = &#123;(animation, finished) <span class="keyword">in</span></div><div class="line">            <span class="keyword">self</span>.flatButton.userInteractionEnabled = <span class="literal">true</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        flatButton.layer.pop_addAnimation(shakeSpringAnimation, forKey: <span class="string">"shakeSpringAnimation"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    显示错误提示标签</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showErrorLabel</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">//缩放</span></div><div class="line">        <span class="keyword">var</span> scaleSpringAnimation = <span class="type">POPSpringAnimation</span>(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleSpringAnimation.toValue = <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPointMake</span>(<span class="number">1</span>, <span class="number">1</span>))</div><div class="line">        scaleSpringAnimation.velocity = <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPointMake</span>(<span class="number">3</span>, <span class="number">3</span>))</div><div class="line">        scaleSpringAnimation.springBounciness = <span class="number">20.0</span></div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(scaleSpringAnimation, forKey: <span class="string">"scaleSpringAnimation"</span>)</div><div class="line"></div><div class="line">        <span class="comment">//position Y</span></div><div class="line">        <span class="keyword">var</span> positionSpringAnimation = <span class="type">POPSpringAnimation</span>(propertyNamed: kPOPLayerPositionY)</div><div class="line">        positionSpringAnimation.toValue = <span class="type">NSNumber</span>(float: <span class="type">Float</span>(flatButton.layer.position.y + flatButton.intrinsicContentSize().height))</div><div class="line">        positionSpringAnimation.springBounciness = <span class="number">20.0</span></div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(positionSpringAnimation, forKey: <span class="string">"positionSpringAnimation"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    隐藏错误提示标签</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">hiddenErrorLabel</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">//缩放</span></div><div class="line">        <span class="keyword">var</span> scaleSpringAnimation = <span class="type">POPSpringAnimation</span>(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleSpringAnimation.toValue = <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPointMake</span>(<span class="number">0.5</span>, <span class="number">0.5</span>))</div><div class="line">        scaleSpringAnimation.velocity = <span class="type">NSValue</span>(<span class="type">CGPoint</span>: <span class="type">CGPointMake</span>(<span class="number">3</span>, <span class="number">3</span>))</div><div class="line">        scaleSpringAnimation.springBounciness = <span class="number">20.0</span></div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(scaleSpringAnimation, forKey: <span class="string">"scaleSpringAnimation"</span>)</div><div class="line"></div><div class="line">        <span class="comment">//position Y</span></div><div class="line">        <span class="keyword">var</span> positionSpringAnimation = <span class="type">POPSpringAnimation</span>(propertyNamed: kPOPLayerPositionY)</div><div class="line">        positionSpringAnimation.toValue = <span class="type">NSNumber</span>(float: <span class="type">Float</span>(flatButton.layer.position.y))</div><div class="line">        positionSpringAnimation.springBounciness = <span class="number">20.0</span></div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(positionSpringAnimation, forKey: <span class="string">"positionSpringAnimation"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/07/09/xcode-cha-jian-bu-neng-shi-yong-wen-ti/" class="prev">上一篇</a><a href="/2015/05/31/ios7-transitionanimation/" class="next">下一篇</a></div><div data-thread-key="2015/06/28/pop-dong-hua/" data-title="POP 动画" data-url="http://iYiming.me/2015/06/28/pop-dong-hua/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2017 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?3cec0b24b46b86302d1aa3b050d4668f";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script></body></html>