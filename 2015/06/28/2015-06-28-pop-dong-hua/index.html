<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> POP 动画 · 一鸣的博客</title><meta name="description" content="POP 动画 - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">POP 动画</h1><div class="post-info">2015年6月28日</div><div class="post-content"><p>前段时间看了些，动画方面的文章，有一个很不错的教程：<a href="https://github.com/AttackOnDobby/iOS-Core-Animation-Advanced-Techniques" target="_blank" rel="external">iOS-Core-Animation-Advanced-Techniques</a>，看会这个动画方面基本上差不多了，剩下的就是举一反三了。</p>
<p>疏于原先没有太过关注 Facebook 的<a href="https://github.com/facebook/pop" target="_blank" rel="external">POP 动画引擎</a>,做的效果这么好，于是就研究了下，找到了些几篇很好的文章：</p>
<p>POP 使用指南：  </p>
<p><a href="http://geeklu.com/2014/05/facebook-pop-usage/" target="_blank" rel="external">http://geeklu.com/2014/05/facebook-pop-usage/</a></p>
<p>很好的 POP 示例教程:</p>
<p><a href="https://github.com/schneiderandre/popping" target="_blank" rel="external">https://github.com/schneiderandre/popping</a><br><a href="https://github.com/kejinlu/facebook-pop-sample" target="_blank" rel="external">https://github.com/kejinlu/facebook-pop-sample</a></p>
<p>上面都是 Objective-C 写的，况且 Swift 出来已经一年了，由于公司项目一直使用 Objective-C，Swift 也得加强学习，故以后做 Demo 就用 Swift 了。</p>
<p>OK，那就仿 Popping,用 Swift 写一个 POP 动画：SwiftPopping。效果如下：</p>
<p><img src="/images/POP/POP1.gif" alt="POP"></p>
<h2 id="0-桥接"><a href="#0-桥接" class="headerlink" title="0.桥接"></a>0.桥接</h2><p>POP 动画引擎是用 Objective-C 写的，想要用在 Swift 项目中，需要用到桥接。  </p>
<p>开始桥接项目：前提是创建了 SwiftPopping 项目并且添加了 POP。</p>
<p>第一步：创建桥接文件：SwiftPopping-Bridging-Header.h<br>第二步：在 SwiftPopping-Bridging-Header.h 文件中写入：<code>#import &lt;pop/POP.h&gt;</code><br>第三步：详见下图：</p>
<p><img src="/images/POP/POP2.jpg" alt="POP"></p>
<p>需要注意的地方就是1中 <code>SwiftPopping-Bridging-Header.h</code> 所在项目的位置。</p>
<p>OK,编译运行，成功！</p>
<p>如果想在 Objective-C 项目中调用 Swift 代码，可以参考下面的文章：  </p>
<p><a href="http://www.shimingwei.com/iOS/OC_Use_Swift.html" target="_blank" rel="external">http://www.shimingwei.com/iOS/OC_Use_Swift.html</a></p>
<h2 id="1-创建按钮-FlatButton"><a href="#1-创建按钮-FlatButton" class="headerlink" title="1.创建按钮 FlatButton"></a>1.创建按钮 FlatButton</h2><p>由于我们需要自定义 UIButton 的一些效果（点进去缩放、出来还原效果），故创建一个FlatButton，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line"></div><div class="line">class FlatButton: UIButton &#123;</div><div class="line">    //标题居上下左右间距</div><div class="line">    override var titleEdgeInsets: UIEdgeInsets&#123;</div><div class="line">        get&#123;</div><div class="line">            return UIEdgeInsetsMake(4.0,28.0,4.0,28.0)</div><div class="line">        &#125;</div><div class="line">        set&#123;</div><div class="line">            self.titleEdgeInsets = newValue</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    class func button() -&gt; FlatButton&#123;</div><div class="line">        var button =  buttonWithType(UIButtonType.Custom) as! FlatButton</div><div class="line">        return button</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    override init(frame: CGRect) &#123;</div><div class="line">        super.init(frame: frame)</div><div class="line">        setup()//设置按钮</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    required init(coder aDecoder: NSCoder) &#123;</div><div class="line">        super.init(coder: aDecoder)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //内容大小</div><div class="line">    override func intrinsicContentSize() -&gt; CGSize &#123;</div><div class="line">        var size = super.intrinsicContentSize()</div><div class="line"></div><div class="line">        return CGSizeMake(size.width + self.titleEdgeInsets.left + self.titleEdgeInsets.right,</div><div class="line">                size.height + self.titleEdgeInsets.top + self.titleEdgeInsets.bottom)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    设置按钮</div><div class="line">    */</div><div class="line">    func setup()&#123;</div><div class="line">        self.backgroundColor = self.tintColor;</div><div class="line">        self.layer.cornerRadius = 4.0</div><div class="line">        self.setTitleColor(UIColor.whiteColor(), forState: UIControlState.Normal)</div><div class="line">        self.titleLabel?.font = UIFont(name: &quot;Avenir-Medium&quot;, size: 22)</div><div class="line"></div><div class="line">        //添加事件</div><div class="line">        self.addTarget(self, action: &quot;scaleToSmall&quot;, forControlEvents: UIControlEvents.TouchDown | UIControlEvents.TouchDragEnter)</div><div class="line">        self.addTarget(self, action: &quot;scaleAnimation&quot;, forControlEvents: UIControlEvents.TouchUpInside)</div><div class="line">        self.addTarget(self, action: &quot;scaleToDefault&quot;, forControlEvents: UIControlEvents.TouchDragExit)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //缩小</div><div class="line">    func scaleToSmall()&#123;</div><div class="line">        var scaleAnimation = POPBasicAnimation(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleAnimation.toValue = NSValue(CGPoint:CGPointMake(0.95, 0.95))</div><div class="line"></div><div class="line">        self.layer.pop_addAnimation(scaleAnimation, forKey: &quot;scaleToSmallAnimation&quot;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //还原</div><div class="line">    func scaleToDefault()&#123;</div><div class="line">        var scaleAnimation = POPBasicAnimation(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleAnimation.toValue = NSValue(CGPoint:CGPointMake(1, 1))</div><div class="line">        </div><div class="line">        self.layer.pop_addAnimation(scaleAnimation, forKey: &quot;scaleToDefaultAnimation&quot;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //动画</div><div class="line">    func scaleAnimation()&#123;</div><div class="line">        var scaleAnimation = POPSpringAnimation(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleAnimation.toValue = NSValue(CGPoint: CGPointMake(1.0, 1.0))</div><div class="line">        scaleAnimation.velocity = NSValue(CGPoint:CGPointMake(3.0, 3.0))</div><div class="line">        scaleAnimation.springBounciness = 18.0</div><div class="line">        </div><div class="line">        self.layer.pop_addAnimation(scaleAnimation, forKey: &quot;scaleAnimation&quot;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-创建-ButtonViewController"><a href="#2-创建-ButtonViewController" class="headerlink" title="2.创建 ButtonViewController"></a>2.创建 ButtonViewController</h2><p>用于实现我们 Gif 图的效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line">import UIKit</div><div class="line"></div><div class="line">class ButtonViewController: UIViewController &#123;</div><div class="line">    var flatButton = FlatButton.button()//按钮</div><div class="line">    var errorLabel = UILabel()//错误标签</div><div class="line">    var activityIndicatorView = UIActivityIndicatorView(activityIndicatorStyle: UIActivityIndicatorViewStyle.Gray)//导航栏右侧Item</div><div class="line"></div><div class="line">    override func viewDidLoad() &#123;</div><div class="line">        super.viewDidLoad()</div><div class="line"></div><div class="line">        // Do any additional setup after loading the view.</div><div class="line"></div><div class="line">        addButton()//添加按钮</div><div class="line">        addLabel()//添加标签</div><div class="line">        addActivityIndicatorView()//添加活动指示视图</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    override func viewWillDisappear(animated: Bool) &#123;</div><div class="line">        super.viewWillDisappear(animated)</div><div class="line"></div><div class="line">        errorLabel.layer.transform = CATransform3DMakeScale(0.5, 0.5, 1)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    override func didReceiveMemoryWarning() &#123;</div><div class="line">        super.didReceiveMemoryWarning()</div><div class="line">        // Dispose of any resources that can be recreated.</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    添加按钮</div><div class="line">    */</div><div class="line">    func addButton()&#123;</div><div class="line">        flatButton.backgroundColor = UIColor(red: 52/255.0, green: 152/255.0, blue: 219/255.0, alpha: 1.0)</div><div class="line">        flatButton.setTitle(&quot;Log in&quot;, forState: UIControlState.Normal)</div><div class="line">        flatButton.setTranslatesAutoresizingMaskIntoConstraints(false)</div><div class="line">        flatButton.addTarget(self, action: &quot;touchUpInside:&quot;, forControlEvents: UIControlEvents.TouchUpInside)</div><div class="line">        view.addSubview(flatButton)</div><div class="line"></div><div class="line">        //添加约束</div><div class="line">        self.view.addConstraint(NSLayoutConstraint(item: flatButton, attribute: NSLayoutAttribute.CenterX, relatedBy: NSLayoutRelation.Equal, toItem: view, attribute: NSLayoutAttribute.CenterX, multiplier: 1, constant: 0.0))</div><div class="line"></div><div class="line">        self.view.addConstraint(NSLayoutConstraint(item: flatButton, attribute: NSLayoutAttribute.CenterY, relatedBy: NSLayoutRelation.Equal, toItem: view, attribute: NSLayoutAttribute.CenterY, multiplier: 1, constant: 0.0))</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    添加标签</div><div class="line">    */</div><div class="line">    func addLabel()&#123;</div><div class="line">        errorLabel.font = UIFont(name: &quot;Avenir-Light&quot;, size: 18)</div><div class="line">        errorLabel.textColor = UIColor(red: 231/255.0, green: 76/255.0, blue: 60/255.0, alpha: 1.0)</div><div class="line">        errorLabel.setTranslatesAutoresizingMaskIntoConstraints(false)</div><div class="line">        errorLabel.text = &quot;Just a serious login error.&quot;</div><div class="line">        errorLabel.textAlignment = NSTextAlignment.Center</div><div class="line">        view.insertSubview(errorLabel, belowSubview: flatButton)</div><div class="line"></div><div class="line">        //添加约束</div><div class="line">        self.view.addConstraint(NSLayoutConstraint(item: errorLabel, attribute: NSLayoutAttribute.CenterX, relatedBy: NSLayoutRelation.Equal, toItem: flatButton, attribute: NSLayoutAttribute.CenterX, multiplier: 1, constant: 0.0))</div><div class="line"></div><div class="line">        self.view.addConstraint(NSLayoutConstraint(item: errorLabel, attribute: NSLayoutAttribute.CenterY, relatedBy: NSLayoutRelation.Equal, toItem: flatButton, attribute: NSLayoutAttribute.CenterY, multiplier: 1, constant: 0.0))</div><div class="line"></div><div class="line">        errorLabel.layer.transform = CATransform3DMakeScale(0.5, 0.5, 1)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    添加活动指示图</div><div class="line">    */</div><div class="line">    func addActivityIndicatorView()&#123;</div><div class="line">        activityIndicatorView.hidesWhenStopped = true</div><div class="line">        self.navigationItem.rightBarButtonItem = UIBarButtonItem(customView: activityIndicatorView)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    按钮点击时</div><div class="line"></div><div class="line">    :param: button 按钮</div><div class="line">    */</div><div class="line">    func touchUpInside(button: FlatButton)&#123;</div><div class="line">        button.userInteractionEnabled = false</div><div class="line">        activityIndicatorView.startAnimating()</div><div class="line">        hiddenErrorLabel()</div><div class="line"></div><div class="line">        let delayTime = dispatch_time(DISPATCH_TIME_NOW,</div><div class="line">        Int64(1 * Double(NSEC_PER_SEC)))</div><div class="line">        dispatch_after(delayTime, dispatch_get_main_queue()) &#123;</div><div class="line">            self.shakeFlatButton()</div><div class="line">            self.showErrorLabel()</div><div class="line">            self.activityIndicatorView.stopAnimating()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    摇晃按钮</div><div class="line">    */</div><div class="line">    func shakeFlatButton()&#123;</div><div class="line">        var shakeSpringAnimation = POPSpringAnimation(propertyNamed: kPOPLayerPositionX)</div><div class="line">        shakeSpringAnimation.velocity = NSNumber(float: 2000.0)</div><div class="line">        shakeSpringAnimation.springBounciness = 20.0</div><div class="line">        shakeSpringAnimation.completionBlock = &#123;(animation, finished) in</div><div class="line">            self.flatButton.userInteractionEnabled = true</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        flatButton.layer.pop_addAnimation(shakeSpringAnimation, forKey: &quot;shakeSpringAnimation&quot;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    显示错误提示标签</div><div class="line">    */</div><div class="line">    func showErrorLabel()&#123;</div><div class="line">        //缩放</div><div class="line">        var scaleSpringAnimation = POPSpringAnimation(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleSpringAnimation.toValue = NSValue(CGPoint: CGPointMake(1, 1))</div><div class="line">        scaleSpringAnimation.velocity = NSValue(CGPoint: CGPointMake(3, 3))</div><div class="line">        scaleSpringAnimation.springBounciness = 20.0</div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(scaleSpringAnimation, forKey: &quot;scaleSpringAnimation&quot;)</div><div class="line"></div><div class="line">        //position Y</div><div class="line">        var positionSpringAnimation = POPSpringAnimation(propertyNamed: kPOPLayerPositionY)</div><div class="line">        positionSpringAnimation.toValue = NSNumber(float: Float(flatButton.layer.position.y + flatButton.intrinsicContentSize().height))</div><div class="line">        positionSpringAnimation.springBounciness = 20.0</div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(positionSpringAnimation, forKey: &quot;positionSpringAnimation&quot;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    隐藏错误提示标签</div><div class="line">    */</div><div class="line">    func hiddenErrorLabel()&#123;</div><div class="line">        //缩放</div><div class="line">        var scaleSpringAnimation = POPSpringAnimation(propertyNamed: kPOPLayerScaleXY)</div><div class="line">        scaleSpringAnimation.toValue = NSValue(CGPoint: CGPointMake(0.5, 0.5))</div><div class="line">        scaleSpringAnimation.velocity = NSValue(CGPoint: CGPointMake(3, 3))</div><div class="line">        scaleSpringAnimation.springBounciness = 20.0</div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(scaleSpringAnimation, forKey: &quot;scaleSpringAnimation&quot;)</div><div class="line"></div><div class="line">        //position Y</div><div class="line">        var positionSpringAnimation = POPSpringAnimation(propertyNamed: kPOPLayerPositionY)</div><div class="line">        positionSpringAnimation.toValue = NSNumber(float: Float(flatButton.layer.position.y))</div><div class="line">        positionSpringAnimation.springBounciness = 20.0</div><div class="line"></div><div class="line">        errorLabel.layer.pop_addAnimation(positionSpringAnimation, forKey: &quot;positionSpringAnimation&quot;)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/07/05/2015-07-05-custom-refresh-and-loading/" class="prev">上一篇</a><a href="/2015/05/31/2015-05-31-ios7-transitionanimation/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2016 <a href="http://yoursite.com">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>