<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 写给大忙人看的 Swift（二） · 一鸣的博客</title><meta name="description" content="写给大忙人看的 Swift（二） - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">写给大忙人看的 Swift（二）</h1><div class="post-info">2015年9月1日</div><div class="post-content"><p><img src="/images/da-mang-ren-swift1/1.JPG" alt="Swift"></p>
<p>注：本系列，仅为自己读书摘要。如果你想购买此书，请移步到 <a href="http://item.jd.com/11732275.html" target="_blank" rel="external">http://item.jd.com/11732275.html</a>  </p>
<p>下面是 《第二章 深入学习Swift语法》的摘抄内容</p>
<p>0.在代码中，变量值可能为空，而错误的使用控制会导致出现错误。为了解决这个问题 Swift 提供了可空类型。可空类型能够安全地检查某个值是否为空，当值不为空时，才会被访问。  </p>
<p>1.在运行时，可空类型有两种不同的表示方式：<code>Some</code> 或者 <code>None</code>。当值不为空时，可空类型用 <code>Optional.Some(value)</code> 表示，否则用 <code>Opational.None</code> 表示，当变量需要存放这两种不同的情况时，我们必须将变量声明为可空类型，在类型说明后面添加一个”?”修饰符（例如，原本的 <code>Int</code> 将变成 <code>Int?</code>）。不限于类，任意类型都可以徐世伟可空类型。  </p>
<p>2.可空类型对值进行了装箱处理，因此不能像对待非可空类型一样对待它们。例如，你不能将一个 <code>String?</code> 当成 <code>String</code> 来用：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> dic = [<span class="string">"name"</span> : <span class="string">"jim"</span>]      </div><div class="line"><span class="keyword">let</span> gender = dic[<span class="string">"gender"</span>] <span class="comment">//gender为String?可空类型</span></div><div class="line"><span class="keyword">let</span> say = <span class="string">"Your gender is"</span> + gender <span class="comment">//出错：可空类型‘String？’无法拆箱 应改为：let say = "Your gender is" + gender！</span></div></pre></td></tr></table></figure>
<p>3.在运行时，如果你对一个不存在的值进行拆箱，应用程序将崩溃。  </p>
<p>4.对于可空类型，在拆箱操作之前，必须检查可空类型是否包含有效值（不为空）,类似的代码非常繁琐，为了使代码更加简洁和可读，Swift 使用了一种将检查和拆箱操作合并到一个步骤的语法，即所谓的可空绑定。它为数据的处理提供了一种简短安全的方法，如下代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> someOptional != <span class="literal">nil</span>&#123;</div><div class="line">	<span class="keyword">let</span> someValue = someOptional!</div><div class="line">	<span class="comment">//正常使用someValue</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以被可空绑定替换为：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> someValue = someOptional&#123;</div><div class="line">	<span class="comment">//正常使用someValue</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>5.泛型结构如下：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxValue</span>&lt;T: comparable&gt;<span class="params">(lhs: T, rhs: T)</span></span> -&gt; <span class="type">T</span> &#123;</div><div class="line">	<span class="keyword">if</span> lhs &gt; rhs&#123;</div><div class="line">		<span class="keyword">return</span> lhs</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> rhs</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的代码中，声明了一个新的函数，并将其命名为 <code>maxValue</code>，与一般的函数不同，在参数列表前面我们使用了一个 <code>&lt;T: Comparable&gt;</code>,这表明我们正在定义一个泛型函数。<code>&lt;T: Comparable&gt;</code>说明这个函数要使用一个泛型 <code>T</code> ，同时 <code>T</code> 必须实现 <code>Comparable</code> 协议（该协议定义了运算符函数，运算会在这个函数中用到）。  </p>
<p>6.Swift 标准库的许多函数和类都使用了泛型。<code>Array</code> 和 <code>Dictionary</code> 就是两个泛型集合。  </p>
<p>7.编译器有时也无法推断出正确的类型信息，这时你可以显式指明值的类型，比如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Speaks</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">func</span> <span class="title">speak</span><span class="params">()</span></span> -&gt; <span class="type">String</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Duck</span>: <span class="title">Speaks</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">func</span> <span class="title">speak</span><span class="params">()</span></span> -&gt; <span class="type">String</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"quack"</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dog</span>: <span class="title">Speaks</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">func</span> <span class="title">speak</span><span class="params">()</span></span> -&gt; <span class="type">String</span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"bark"</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> fido = <span class="type">Dog</span>()</div><div class="line"><span class="keyword">let</span> donald = <span class="type">Duck</span>()</div><div class="line"></div><div class="line"><span class="keyword">let</span> pets = [fido, donald] <span class="comment">//错误：无法恒却判断出数组的类型</span></div><div class="line"></div><div class="line"><span class="comment">//需要将上面的代码改为：</span></div><div class="line"><span class="keyword">let</span> pets: [<span class="type">Speaks</span>] = [fido, donald]</div></pre></td></tr></table></figure>
<p>8.闭包提供了一种创建自包含代码片段的函数式方法，同时还能从上下文中自动捕获值。闭包一次取义于”从上下文中捕获变量常量”，即”封闭”值的意思。Swift 的闭包类似 Objective-C 中的块（block），只不过在使用上更加灵活。  </p>
<p>9.闭包有三种不同的形式：全局函数、嵌套函数、闭包表达式，每一种都有各自的用途。</p>
<p>10.闭包表达式提供了一种轻量级的隔离代码的方法（不需要对代码块进行命名），同时从上下文中捕获值。下面是一个闭包表达式的例子：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> aFewNumbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]  </div><div class="line"><span class="keyword">var</span> squares = aFewNumbers.<span class="built_in">map</span>(&#123; (num: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span> </div><div class="line">	<span class="keyword">return</span> num * num</div><div class="line">&#125;)</div><div class="line"><span class="comment">//squares = [1, 4, 9]</span></div></pre></td></tr></table></figure>
<p>11.Swift 中的元组，是一种轻巧实用的数据结构，允许你将多个值结合成一个对象。  </p>
<p>12.要访问元组的成员，你可以通过索引或者将远足分解到多个变量中。例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> iceCreamCone = (<span class="number">2</span>, <span class="string">"chocolate"</span>, <span class="string">"cone"</span>)</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"I'd like <span class="subst">\(iceCreamCone.<span class="number">0</span>)</span> scoop(s) of <span class="subst">\(iceCreamCone.<span class="number">1</span>)</span> in a <span class="subst">\(iceCreamCone.<span class="number">2</span>)</span>"</span>)</div></pre></td></tr></table></figure>
<p>13.也可以在创建元组时，为每个成员进行命名，以便通过名称来访问元组成员，这种方法能清楚的描述元组所储存的数据，对于简单的类，可以直接用元组代替。  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> iceCreamCone = (scoops:<span class="number">2</span>, flavor:<span class="string">"chocolate"</span>, style:<span class="string">"cone"</span>)</div><div class="line"></div><div class="line"><span class="built_in">println</span>(<span class="string">"I'd like <span class="subst">\(iceCreamCone.scoops)</span> scoop(s) of <span class="subst">\(iceCreamCone.flavor)</span> in a <span class="subst">\(iceCreamCone.style)</span>"</span>)</div></pre></td></tr></table></figure>
<p>14.返回值可以指定名称也可以不指定名称：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//不指定名称</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberCounts</span><span class="params">(nums: [Int])</span></span> -&gt; (<span class="type">Int</span>, <span class="type">Int</span>)</div><div class="line"><span class="comment">//指定名称</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberCounts</span><span class="params">(nums: [Int])</span></span> -&gt; (even: <span class="type">Int</span>, odd: <span class="type">Int</span>)</div></pre></td></tr></table></figure>
<p>15.如果元组中的某个值你不需要，在分解时你可以用下划线 <code>_</code> 替代。</p>
<p>16.在 Swift 中，<code>switch</code> 结构，如果你需要代码贯穿到下一分支，你必须显式地实用<code>fallthrough</code> 关键字。例如：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">colorForIndexPath</span><span class="params">(indexPath: NSIndexPath)</span></span> -&gt; <span class="type">UIColor</span> &#123;</div><div class="line">	<span class="keyword">switch</span> (indexPath.section)&#123;</div><div class="line">		<span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">			<span class="keyword">fallthrough</span></div><div class="line">		<span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">			<span class="keyword">fallthrough</span></div><div class="line">		<span class="keyword">case</span> <span class="number">4</span>:</div><div class="line">			<span class="keyword">return</span> <span class="type">UIColor</span>.blueColor()</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">return</span> <span class="type">UIColor</span>.whiteColor()</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>17.在 <code>case</code> 中实用 <code>where</code> 子句，这为 <code>switch</code> 语句提供了更多的灵活性。你还可以在 <code>case</code> 语句中使用值绑定，从而使代码更加紧凑，可读性更好。如：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> indexSizeAndValue = (<span class="number">9</span>, <span class="number">10</span>, <span class="string">""</span>)</div><div class="line"><span class="keyword">switch</span> indexSizeAndValue&#123;</div><div class="line">	<span class="keyword">case</span> (<span class="number">0</span>,<span class="number">_</span>,<span class="keyword">let</span> value):</div><div class="line">		<span class="built_in">print</span>(<span class="string">"The first value is <span class="subst">\(value)</span>"</span>)</div><div class="line">	<span class="keyword">case</span> <span class="keyword">let</span> (index,size,<span class="string">""</span>) <span class="keyword">where</span> index == (size - <span class="number">1</span>):</div><div class="line">		<span class="built_in">print</span>(<span class="string">"The last value is empty"</span>)</div><div class="line">	<span class="keyword">case</span> <span class="keyword">let</span> (index,size,value) <span class="keyword">where</span> index == (size-<span class="number">1</span>):</div><div class="line">		<span class="built_in">print</span>(<span class="string">"The last value is <span class="subst">\(value)</span>"</span>)</div><div class="line">	<span class="keyword">case</span> <span class="keyword">let</span> (index,<span class="number">_</span>,value):</div><div class="line">		<span class="built_in">print</span>(<span class="string">"The value at index <span class="subst">\(index)</span> is <span class="subst">\(value)</span>"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/09/17/ios-9-fen-xiang/" class="prev">上一篇</a><a href="/2015/08/24/da-mang-ren-swift-01/" class="next">下一篇</a></div><div data-thread-key="2015/09/01/da-mang-ren-swift-02/" data-title="写给大忙人看的 Swift（二）" data-url="http://iYiming.me/2015/09/01/da-mang-ren-swift-02/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2017 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?3cec0b24b46b86302d1aa3b050d4668f";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm, s);})();</script></body></html>