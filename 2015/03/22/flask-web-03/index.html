<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Flask Web 开发学习笔记（三） · 一鸣的博客</title><meta name="description" content="Flask Web 开发学习笔记（三） - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Flask Web 开发学习笔记（三）</h1><div class="post-info">2015年3月22日</div><div class="post-content"><p>本文主要整理下几个 Flask 扩展：</p>
<p><strong>0.Flask-Bootstrap</strong>：集成 Twitter 开发的一个开源框架 Bootstrap</p>
<p><strong>1.Flask-Script</strong>：为 Flask 程序添加一个命令行解析器  </p>
<p><strong>2.Flask-Moment</strong>：本地化日期和时间  </p>
<p>本篇基于前两篇博文，需要使用虚拟环境、使用 pip 安装 Flask 等。</p>
<h2 id="什么是扩展"><a href="#什么是扩展" class="headerlink" title="什么是扩展"></a>什么是扩展</h2><p>Flask 被设计为可扩展形式，故而没有提供一些重要的功能，例如数据库和用户认证，所以我们可以选择最适合的程序的包，或者按需求自行开发。</p>
<p>说白了扩展就是一些附加功能，独立完成某种功能。</p>
<h2 id="Flask-Bootstrap"><a href="#Flask-Bootstrap" class="headerlink" title="Flask-Bootstrap"></a>Flask-Bootstrap</h2><p>Bootstrap 是 Twitter 开发的一个开源框架，它提供的用户界面组件可用于创建整洁且具有吸引力的网页，而且这些网页还能兼容所有现代 Web 浏览器。  </p>
<p>Bootstrap 是客户端框架，因此不会直接涉及服务器。</p>
<p>服务器需要做的指示提供引用了 Bootstrap 层叠样式表（ CSS ）和 Javascript 文件的 HTML 响应，并在 HTML、CSS 和 JavaScript 代码中实例化所需组件。这些操作最理想的执行场所就是<strong>模板</strong>。</p>
<h4 id="安装-Flask-Bootstrap-扩展"><a href="#安装-Flask-Bootstrap-扩展" class="headerlink" title="安装 Flask-Bootstrap 扩展"></a>安装 Flask-Bootstrap 扩展</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install flask-bootstrap</div></pre></td></tr></table></figure>
<h4 id="创建-app-py-文件"><a href="#创建-app-py-文件" class="headerlink" title="创建 app.py 文件"></a>创建 app.py 文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template</div><div class="line"><span class="keyword">from</span> flask.ext.bootstrap <span class="keyword">import</span> Bootstrap</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line">bootstrap = Bootstrap(app)<span class="comment">#注意这个地方 </span></div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    app.run(debug = <span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.<code>from flask.ext.bootstrap import Bootstrap</code>：专为 Flask 开发的扩展都暴露在 flask.ext 命名空间下，Flask-Bootstrap 输出了一个 Bootstrap 类。</p>
<p>1.<code>bootstrap = Bootstrap(app)</code>：Flask 扩展一般都在创建程序实例时初始化，这行代码是 Flask-Bootstrap 的初始化方法。</p>
</blockquote>
<h4 id="创建-templates-文件夹并创建-base-html"><a href="#创建-templates-文件夹并创建-base-html" class="headerlink" title="创建 templates 文件夹并创建 base.html"></a>创建 templates 文件夹并创建 base.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "bootstrap/base.html"  %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;Flask&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block navbar %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">  &#123;% block page_content %&#125;&#123;% endblock %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.<code>{% extends "bootstrap/base.html"  %}</code>：base.html 模板继承自 <code>bootstrap/base.html</code></p>
<p>1.其中 <code>title</code>、<code>navbar</code>、 <code>content</code>都是 <code>bootstrap/base.html</code>中定义的块（还有 <code>script</code> 等）。<code>navbar</code> 是显示导航栏。其中的代码比较多，作用是添加 Flasky 和 Home 两个链接，理解下即可。</p>
<p>2.<code>page_content</code>块是自己加的。</p>
<p>3.以后的 html 页面直接继承 base.html 就可以啦。</p>
</blockquote>
<h4 id="创建-index-html"><a href="#创建-index-html" class="headerlink" title="创建 index.html"></a>创建 index.html</h4><p>index.html 中写入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "base.html" %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;首页&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block page_content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这里是首页，Hello World！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.<code>{% extends "base.html" %}</code> ：继承自 base.html</p>
<p>1.<code>page_content</code> 块就是上面的自己定义的块。</p>
</blockquote>
<h4 id="运行程序"><a href="#运行程序" class="headerlink" title="运行程序"></a>运行程序</h4><p>显示如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/139348-bdac5d74e4ed1248.png" alt="运行结果.png"></p>
<h2 id="Flask-Script"><a href="#Flask-Script" class="headerlink" title="Flask-Script"></a>Flask-Script</h2><p>Flask 的开发 Web 服务器支持很多启动设置选项，但只能在脚本中作为参数传给<code>app.run()</code>函数。这种方式很不方便，传递设置选项的理想方式是使用命令行参数。  </p>
<p>Flask-Script 就是这么一个 Flask 扩展，为 Flask 程序添加一个命令行解析器。Flask-Script 自带了一组常用选项，而且还支持自定义命令。  </p>
<h4 id="安装-Flask-Script-扩展"><a href="#安装-Flask-Script-扩展" class="headerlink" title="安装 Flask-Script 扩展"></a>安装 Flask-Script 扩展</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install flask-script</div></pre></td></tr></table></figure>
<h4 id="修改-app-py-文件"><a href="#修改-app-py-文件" class="headerlink" title="修改 app.py 文件"></a>修改 app.py 文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template</div><div class="line"><span class="keyword">from</span> flask.ext.bootstrap <span class="keyword">import</span> Bootstrap</div><div class="line"><span class="keyword">from</span> flask.ext.script <span class="keyword">import</span> Manager</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line">manager = Manager(app)<span class="comment">#注意这个地方</span></div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    manager.run()<span class="comment">#注意这个地方</span></div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.<code>from flask.ext.script import Manager</code>：Flask-Script 输出了一个名为 Manager 的类，同样也是 <code>flask.ext.XXX</code> 下。</p>
<p>1.<code>manager.run()</code> 代替了 <code>app.run()</code>，启动后就能解析命令行啦。</p>
</blockquote>
<h4 id="使用-Flask-Script"><a href="#使用-Flask-Script" class="headerlink" title="使用 Flask-Script"></a>使用 Flask-Script</h4><p><strong>0.运行 app.py :<code>python app.py</code></strong></p>
<p><strong>1.<a href="http://flask-script.readthedocs.org/en/latest/" target="_blank" rel="external"> Flask-Script 官方文档</a></strong></p>
<h2 id="Flask-Moment"><a href="#Flask-Moment" class="headerlink" title="Flask-Moment"></a>Flask-Moment</h2><p>服务器需要统一时间单位，这和用户所在的地理位置无关，所以一般使用协调世界时间（Coordinated Universal Time, UTC）。用户不愿意看到 UTC 时间，他们更希望看到当地时间，而且采用当地惯用的格式。    </p>
<p>要想在服务器上只使用 UTC 时间，一个优雅的解决方案是，把时间单位发送给 Web 浏览器。转换成当地时间，然后渲染。Web 浏览器可以更好的完成这一任务，因为它能获取用户电脑中的时区和区域设置。  </p>
<p>有一个使用 JavaScript 开发的优秀客户端开源代码，名为 moment.js (<a href="http://momentjs.com/" target="_blank" rel="external">http://momentjs.com/</a>),它可以在浏览器中渲染日期和时间。</p>
<h4 id="安装-Flask-Moment-扩展"><a href="#安装-Flask-Moment-扩展" class="headerlink" title="安装 Flask-Moment 扩展"></a>安装 Flask-Moment 扩展</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install flask-moment</div></pre></td></tr></table></figure>
<h4 id="修改-app-py-文件-1"><a href="#修改-app-py-文件-1" class="headerlink" title="修改 app.py 文件"></a>修改 app.py 文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template</div><div class="line"><span class="keyword">from</span> flask.ext.bootstrap <span class="keyword">import</span> Bootstrap</div><div class="line"><span class="keyword">from</span> flask.ext.script <span class="keyword">import</span> Manager</div><div class="line"><span class="keyword">from</span> flask.ext.moment <span class="keyword">import</span> Moment</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line">manager = Manager(app)</div><div class="line">bootstrap = Bootstrap(app)</div><div class="line">moment = Moment(app)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,current_time=datetime.utcnow())</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    manager.run()</div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.<code>from flask.ext.moment import Moment</code>：导入一个 Moment 类</p>
<p>1.<code>from datetime import datetime</code>：导入一个 datetime 类，用于获取 UTC 时间</p>
<p>2.<code>moment = Moment(app)</code>：向模板开放了 Moment 类，可以在模板中使用</p>
<p>3.<code>current_time=datetime.utcnow()</code>：获取当前 UTC 时间，作为参数传入<code>index.html</code></p>
</blockquote>
<h4 id="修改-base-html"><a href="#修改-base-html" class="headerlink" title="修改 base.html"></a>修改 base.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "bootstrap/base.html"  %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;Flask&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block navbar %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">  &#123;% block page_content %&#125;&#123;% endblock %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--注意下方block script--&gt;</span></div><div class="line">&#123;% block scripts %&#125;</div><div class="line">&#123;% raw %&#125;&#123;&#123;  super() &#125;&#125;&#123;% endraw %&#125;</div><div class="line">&#123;% raw %&#125;&#123;&#123; moment.include_moment() &#125;&#125;&#123;% endraw %&#125;</div><div class="line">&#123;% endblock %&#125;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.除了 <code>moment.js</code> ，Flask-Moment 还依赖 <code>jquery.js</code> 。但是 Bootstrap 中已经引入了 jquery.js ，故只需要引入 <code>moment.js</code></p>
<p>1.<code>{{ moment.include_moment() }}</code> ：引入 <code>moment.js</code>，请注意上方的<code>{{  super() }}</code></p>
</blockquote>
<h4 id="修改-index-html"><a href="#修改-index-html" class="headerlink" title="修改 index.html"></a>修改 index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "base.html" %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;首页&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block page_content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这里是首页，Hello World！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; moment(current_time).format('LLL') &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; moment(current_time).fromNow(refresh=True) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<p>解释下：</p>
<blockquote>
<p>0.<code>{{ moment(current_time).format('LLL') }}</code>：根据客户端电脑中的时区和区域设置渲染日期和时间。参数决定了渲染的方式，’L’到’LLL’分别对应不同的复杂度。<code>format()</code>函数还可以接受自定义的格式说明符。</p>
<p>1.<code>{{ moment(current_time).fromNow(refresh=True) }}</code>：<code>moment</code>是 app.py 开放的类，<code>current_time</code> 是 app.py 传递过来的参数，<code>fromNow()</code> 渲染相对时间戳，参数 <code>refresh=True</code> 会随着时间的推移自动刷新显示时间。</p>
</blockquote>
<h2 id="一个完整的-Demo"><a href="#一个完整的-Demo" class="headerlink" title="一个完整的 Demo"></a>一个完整的 Demo</h2><p>这个 Demo，包含上方未介绍到的东西：</p>
<p><strong>0.url_for() 函数的使用</strong><br><strong>1.静态文件的引入：设置网页的小图标（如百度网页的那个小熊掌）</strong><br><strong>2.自定义 404 错误页面</strong></p>
<h4 id="创建文件夹，包含文件"><a href="#创建文件夹，包含文件" class="headerlink" title="创建文件夹，包含文件"></a>创建文件夹，包含文件</h4><p>文件夹结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">--app</div><div class="line">	--app.py</div><div class="line">	--templates</div><div class="line">		--base.html</div><div class="line">		--index.html</div><div class="line">		--user.html</div><div class="line">		--404.html</div><div class="line">	--static</div><div class="line">		--favicon.png</div><div class="line">	--venv</div></pre></td></tr></table></figure>
<h4 id="app-py"><a href="#app-py" class="headerlink" title="app.py"></a>app.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template</div><div class="line"><span class="keyword">from</span> flask.ext.bootstrap <span class="keyword">import</span> Bootstrap</div><div class="line"><span class="keyword">from</span> flask.ext.script <span class="keyword">import</span> Manager</div><div class="line"><span class="keyword">from</span> flask.ext.moment <span class="keyword">import</span> Moment</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line">manager = Manager(app)</div><div class="line">bootstrap = Bootstrap(app)</div><div class="line">moment = Moment(app)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,current_time=datetime.utcnow())</div><div class="line"></div><div class="line"><span class="meta">@app.route('/user/&lt;name&gt;')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">user</span><span class="params">(name)</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'user.html'</span>,name=name)</div><div class="line"></div><div class="line"><span class="meta">@app.errorhandler(404)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(e)</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'404.html'</span>),<span class="number">404</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    manager.run()</div></pre></td></tr></table></figure>
<h4 id="base-html"><a href="#base-html" class="headerlink" title="base.html"></a>base.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "bootstrap/base.html"  %&#125;</div><div class="line"></div><div class="line">&#123;% block head %&#125;</div><div class="line">&#123;&#123; super() &#125;&#125;</div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('static',filename = 'favicon.png') &#125;&#125;"</span>  <span class="attr">type</span>=<span class="string">'image/x-icon'</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('static',filename = 'favicon.png')  &#125;&#125;"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span>/&gt;</span></div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;Flask&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block navbar %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">".navbar-collapse"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Flasky<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">  &#123;% block page_content %&#125;&#123;% endblock %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">&#123;% block scripts %&#125;</div><div class="line">&#123;&#123;  super() &#125;&#125;</div><div class="line">&#123;&#123; moment.include_moment() &#125;&#125;</div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "base.html" %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;首页&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block page_content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这里是首页，Hello World！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; moment(current_time).format('LLL') &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; moment(current_time).fromNow(refresh=True) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<h4 id="user-html"><a href="#user-html" class="headerlink" title="user.html"></a>user.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "base.html"  %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;User&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block page_content %&#125;</div><div class="line"></div><div class="line">&#123;% if name %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Hello &#123;&#123; name &#125;&#125; <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">&#123;% else  %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Hello Stranger <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">&#123;% endif %&#125;</div><div class="line"></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<h4 id="404-html"><a href="#404-html" class="headerlink" title="404.html"></a>404.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;% extends "base.html" %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125; 404 &#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block page_content %&#125;</div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> 404 错误：页面没有找到 <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<h4 id="favicon-png"><a href="#favicon-png" class="headerlink" title="favicon.png"></a>favicon.png</h4><p><a href="http://iyiming.me/favicon.png">favicon.png</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/04/06/flask-web-04/" class="prev">上一篇</a><a href="/2015/03/17/flask-web-02/" class="next">下一篇</a></div><div data-thread-key="2015/03/22/flask-web-03/" data-title="Flask Web 开发学习笔记（三）" data-url="http://iYiming.me/2015/03/22/flask-web-03/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></body></html>