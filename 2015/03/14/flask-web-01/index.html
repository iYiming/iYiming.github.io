<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Flask Web 开发学习笔记（一） · 一鸣的博客</title><meta name="description" content="Flask Web 开发学习笔记（一） - iYiming"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://iYiming.me/atom.xml" title="一鸣的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jiajiayouba" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/iYiming" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Flask Web 开发学习笔记（一）</h1><div class="post-info">2015年3月14日</div><div class="post-content"><p>本文章主要整理：  </p>
<blockquote>
<p>0.如何使用虚拟环境<br>1.如何用 <code>pip</code> 安装 Python 包（Demo：如何安装 <code>flask</code>）<br>2.一个简单的 Demo   </p>
</blockquote>
<h2 id="如何使用虚拟环境"><a href="#如何使用虚拟环境" class="headerlink" title="如何使用虚拟环境"></a>如何使用虚拟环境</h2><p>在介绍使用虚拟环境前，需要提前安装 Python 3.4(<a href="http://iyiming.me/blog/2015/03/01/she-is-python/">原先写的文章有介绍</a>)。  </p>
<p>Python 3.4 通过 <code>venv</code> 模块原生支持虚拟环境，命令为 <code>pyvenv</code>。</p>
<p><strong>0.创建一个名字为 <code>venv</code> 虚拟环境</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pyvenv venv</div></pre></td></tr></table></figure>
<p><strong>1.激活名字为： <code>venv</code> 的虚拟环境</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source venv/bin/activate</div></pre></td></tr></table></figure>
<p><strong>2.激活虚拟环境命令会修改命令行提示符,显示如下:</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(venv) $</div></pre></td></tr></table></figure>
<p><strong>3.退出当前虚拟环境</strong>  </p>
<p>使用命令：<code>deactivate</code></p>
<h2 id="使用-pip-安装-Python-包"><a href="#使用-pip-安装-Python-包" class="headerlink" title="使用 pip 安装 Python 包"></a>使用 pip 安装 Python 包</h2><p>大多数 Python 包都使用 <code>pip</code> 实用工具安装，使用 <code>pyvenv</code> 创建的虚拟环境会自动安装 <code>pip</code>。</p>
<p><strong>1.使用 <code>pip</code> 安装 <code>Flask</code>（其它 Python 包同理）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install flask</div></pre></td></tr></table></figure>
<h2 id="一个简单的-Demo"><a href="#一个简单的-Demo" class="headerlink" title="一个简单的 Demo"></a>一个简单的 Demo</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</div><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort</div><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;Hello World!&lt;/h1&gt;'</span></div><div class="line"></div><div class="line"><span class="meta">@app.route('/user/&lt;name&gt;')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayHello</span><span class="params">(name)</span>:</span></div><div class="line">    <span class="keyword">if</span> name == <span class="string">'baidu'</span>:</div><div class="line">        <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</div><div class="line">    <span class="keyword">elif</span> name == <span class="string">'NO'</span>:</div><div class="line">        <span class="keyword">return</span> abort(<span class="number">404</span>)</div><div class="line">        </div><div class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt; Hello,%s &lt;/h1&gt;'</span> % name</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    app.run(debug=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>从 Demo 中学习路由、修饰器、视图函数、请求、响应概念，一步步分析每行代码：</p>
<p><strong>0.<code>from flask import Flask</code></strong>  </p>
<p>从 <code>flask</code> 库中导入 <code>Flask</code> 函数，<code>from flask import abort</code> 和 <code>from flask import redirect</code> 同理。</p>
<p><strong>1.<code>app = Flask(__name__)</code></strong>  </p>
<p>创建 <code>Flask</code> 对象 <code>app</code>，<code>Flask</code> 类的构造函数只有一个必须指定的参数，即程序主模块或包的名字。在大多数程序中，Python 的 <code>__name__</code> 变量就是所需要的值。</p>
<p><strong>2.<code>@app.route(&#39;/&#39;)</code></strong></p>
<p>客户端（例如 Web 浏览器）把请求发送给 Web 服务器,Web 服务器再把请求发送给 Flask 程序实例。程序实例需要知道对每个 URL 请求运行哪些代码，所以保存了一个 URL 到 Python 函数的映射关系。处理 URL 和函数之间的关系的程序称为<strong>路由</strong>。</p>
<p>在 Flask 程序中定义路由的最简便方式，是使用程序实例提供的 <code>app.route</code> 修饰器，把修饰的函数注册为路由。</p>
<p><strong>修饰器</strong>是 Python 语言的标准特性，可以使用不同的方式修改函数的行为。惯常用法是使用修饰器把函数注册为事件的处理程序。</p>
<p><strong>3.<code>def index():</code>函数</strong></p>
<p><code>index()</code> 函数放在 <code>@app.route(&#39;/&#39;)</code> 后面，所以就是把 <code>index()</code> 函数注册为路由。</p>
<p>如果部署程序的服务器域名为 <code>www.example.com</code>,在浏览器中访问 <code>www.example.com</code> 后，会触发服务器执行 <code>index()</code> 函数。</p>
<p><strong>4.<code>@app.route(&#39;/user/&lt;name&gt;&#39;)</code></strong>  </p>
<p>同 <code>@app.route(&#39;/&#39;)</code>，如果部署程序的服务器域名为 <code>www.example.com</code>，在浏览器中访问 <code>www.example.com/user/tom</code> 后，会触发服务器执行下方修饰函数 <code>sayHello(name)</code>。</p>
<p><strong>5.<code>sayHello(name)</code>函数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> name == <span class="string">'baidu'</span>:</div><div class="line">    <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</div><div class="line"><span class="keyword">elif</span> name == <span class="string">'NO'</span>:</div><div class="line">    <span class="keyword">return</span> abort(<span class="number">404</span>)</div><div class="line">    </div><div class="line"><span class="keyword">return</span> <span class="string">'&lt;h1&gt; Hello,%s &lt;/h1&gt;'</span> % name</div></pre></td></tr></table></figure>
<p>假定部署程序的服务器域名为 <code>www.example.com</code>。</p>
<p>在浏览器中访问 <code>www.example.com/user/baidu</code>，那么 <code>redirect()</code> 函数就直接链接到百度了。</p>
<p>注意的是，在使用 <code>redirect()</code> 函数之前，必须使用 <code>from flask import redirect</code> 从 flask 库中导入 <code>redirect()</code> 函数。</p>
<p>在浏览器中访问 <code>www.example.com/user/NO</code>，那么 <code>abort()</code> 函数就会触发。  </p>
<p><code>abort()</code> 函数用于处理错误，<code>abort(404)</code> 返回 404 错误，<code>abort()</code>函数不会把控制权交还给调用它的函数，而是抛出异常把控制权交给Web服务器。</p>
<p>在浏览器中访问 <code>www.example.com/user/tom</code>，那么会正确执行，在浏览器中显示 <code>Hello,tom</code>。</p>
<p><strong>6.<code>if __name__ == &#39;__main__&#39;:</code></strong></p>
<p>一开始也没弄懂，这句话是什么意思。在 <a href="http://stackoverflow.com/questions/419163/what-does-if-name-main-do" target="_blank" rel="external">StackOverflow</a> 中找到了答案。</p>
<p>大致翻一下：</p>
<blockquote>
<p>当 Python 解释器，读 py 文件,它会执行它发现的所有代码。在执行代码之前，它会定义一些变量。例如，如果这个 py 文件就是主程序，它会设置<code>__name__</code>变量为<code>&quot;__main__&quot;</code>。如果这个 py 被引入到别的模块，<code>__name__</code>会被设置为该模块的名字。</p>
<p>举个栗子：<br>创建一个 test.py 文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">	<span class="keyword">print</span> <span class="string">'自己主动执行'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">	<span class="keyword">print</span> <span class="string">'我被别的模块引入'</span></div></pre></td></tr></table></figure>
<p>执行下 <code>$ python test.py</code> 会输出<code>自己主动执行</code><br>直接在命令行中输入 <code>python</code> 随后输入 <code>import test</code>，会输出：<code>我被别的模块引入</code>。  </p>
</blockquote>
<p><strong>7.<code>app.run(debug=True)</code></strong></p>
<p>程序实例用 <code>run()</code> 方法启动 Flask 继承的开发 Web 服务器。</p>
<p>服务器启动后，会进入轮询，等待并处理请求。轮询会一直进行，直到程序停止，比如按<code>Ctrl-C</code>键。</p>
<p><code>debug=True</code>表示启用调试模式。方便我们调试。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/03/17/flask-web-02/" class="prev">上一篇</a><a href="/2015/03/03/jing-cheng-yi-nian/" class="next">下一篇</a></div><div data-thread-key="2015/03/14/flask-web-01/" data-title="Flask Web 开发学习笔记（一）" data-url="http://iYiming.me/2015/03/14/flask-web-01/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"jiajiayouba"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016 <a href="http://iYiming.me">iYiming</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253468447'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s6.cnzz.com/z_stat.php%3Fid%3D1253468447%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></body></html>